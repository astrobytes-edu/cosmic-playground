<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Parallax Distance â€” Cosmic Playground</title>
    <link rel="stylesheet" href="./style.css" />
    <link rel="stylesheet" href="../../assets/katex/katex.min.css" />
  </head>
  <body>
    <canvas class="cp-starfield" aria-hidden="true"></canvas>
    <div
      id="cp-demo"
      class="cp-layer-instrument cp-demo parallax-demo"
      data-shell="triad"
      aria-label="Parallax Distance instrument"
    >
      <aside class="cp-demo__sidebar cp-panel" aria-label="Controls panel">
        <div class="cp-panel-header">Parallax Distance</div>
        <div class="cp-panel-body cp-scroll-shadow">
          <div class="cp-utility-toolbar" role="toolbar" aria-label="Demo actions">
            <button id="stationMode" class="cp-utility-btn" type="button" aria-label="Station mode" title="Station mode">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <rect x="4" y="2" width="12" height="16" rx="1.5"></rect>
                <line x1="7" y1="7" x2="13" y2="7"></line>
                <line x1="7" y1="10" x2="13" y2="10"></line>
                <line x1="7" y1="13" x2="10" y2="13"></line>
              </svg>
            </button>
            <button id="help" class="cp-utility-btn" type="button" aria-label="Help and shortcuts" title="Help / keys">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="10" cy="10" r="8"></circle>
                <path d="M7.5 7.5a2.5 2.5 0 0 1 5 0c0 1.5-2.5 2-2.5 3.5"></path>
                <circle cx="10" cy="15" r="0.75" fill="currentColor" stroke="none"></circle>
              </svg>
            </button>
            <button id="copyResults" class="cp-utility-btn" type="button" aria-label="Copy results" title="Copy results">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <rect x="6" y="6" width="10" height="12" rx="1.5"></rect>
                <path d="M14 6V3.5A1.5 1.5 0 0 0 12.5 2H5.5A1.5 1.5 0 0 0 4 3.5V14"></path>
              </svg>
            </button>
            <div class="cp-popover-anchor">
              <button class="cp-utility-btn cp-popover-trigger" aria-label="Navigation links" aria-expanded="false" aria-controls="navPopover" title="More links" type="button">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <circle cx="4" cy="10" r="1.5"></circle>
                  <circle cx="10" cy="10" r="1.5"></circle>
                  <circle cx="16" cy="10" r="1.5"></circle>
                </svg>
              </button>
              <div class="cp-popover" id="navPopover" hidden>
                <nav class="cp-popover__body">
                  <a class="cp-popover-link" href="../../exhibits/parallax-distance/">Open exhibit</a>
                  <a class="cp-popover-link" href="../../stations/parallax-distance/">Station card</a>
                  <a class="cp-popover-link" href="../../instructor/parallax-distance/">Instructor notes</a>
                </nav>
              </div>
            </div>
          </div>

          <p class="cp-muted">
            Earth moves along its orbit, the viewing direction changes, and the target appears to shift against distant stars.
          </p>

          <div class="cp-callout" data-kind="model">
            <strong>Model</strong>
            <div>$$d\,(\mathrm{pc})=\frac{1}{p\,(\mathrm{arcsec})}$$</div>
          </div>

          <label class="cp-field">
            <span class="cp-label">Preset star (optional)</span>
            <select id="starPreset" class="cp-select"></select>
          </label>

          <div class="cp-field">
            <span class="cp-label">Distance $d$ (primary input)</span>
            <div class="distance-input-grid">
              <label class="distance-input-cell">
                <span class="distance-input-label">pc</span>
                <input id="distancePcInput" class="cp-input" type="number" min="1" max="5000" step="0.1" value="10" />
              </label>
              <label class="distance-input-cell">
                <span class="distance-input-label">ly</span>
                <input id="distanceLyInput" class="cp-input" type="number" min="3.26" max="16308" step="0.1" value="32.62" />
              </label>
            </div>
            <div id="distancePcValue" class="cp-field__value">10.0 pc</div>
            <input
              id="distancePcRange"
              class="cp-range"
              type="range"
              min="1"
              max="5000"
              value="10"
              step="0.1"
              data-tooltip-source="#distancePcValue"
            />
            <div class="cp-field__hint">Parallax $p$ is inferred from this distance, not directly set.</div>
          </div>

          <div class="cp-field">
            <span class="cp-label">Observation epochs</span>
            <div class="cp-chip-group" role="group" aria-label="Reference epoch presets">
              <button id="phasePresetJan" class="cp-chip phase-preset is-active" type="button" data-phase="0" aria-pressed="true">Jan</button>
              <button id="phasePresetApr" class="cp-chip phase-preset" type="button" data-phase="90" aria-pressed="false">Apr</button>
              <button id="phasePresetJul" class="cp-chip phase-preset" type="button" data-phase="180" aria-pressed="false">Jul</button>
              <button id="phasePresetOct" class="cp-chip phase-preset" type="button" data-phase="270" aria-pressed="false">Oct</button>
            </div>
            <div id="phaseDegValue" class="cp-field__value">0 deg (Jan reference)</div>
            <input
              id="phaseDeg"
              class="cp-range"
              type="range"
              min="0"
              max="360"
              value="0"
              step="1"
              data-tooltip-source="#phaseDegValue"
            />
            <div class="cp-field__hint">The second epoch is always 180 deg later (about 6 months).</div>
          </div>

          <div class="cp-field cp-field--compact">
            <label class="cp-check">
              <input id="showBaseline" type="checkbox" checked /> Show baseline vector (default on)
            </label>
          </div>

          <div class="cp-field">
            <span class="cp-label">Detector view mode</span>
            <div class="cp-chip-group" role="group" aria-label="Detector mode">
              <button id="detectorModeOverlay" class="cp-chip is-active" type="button" aria-pressed="true">Overlay</button>
              <button id="detectorModeDifference" class="cp-chip" type="button" aria-pressed="false">Difference</button>
            </div>
            <label class="cp-check cp-check--inline">
              <input id="blinkMode" type="checkbox" /> Blink Jan/Jul
            </label>
          </div>

          <label class="cp-field">
            <span class="cp-label">Uncertainty $\sigma_p$</span>
            <div id="sigmaMasValue" class="cp-field__value">1.0 mas</div>
            <input
              id="sigmaMas"
              class="cp-range"
              type="range"
              min="0.1"
              max="20"
              value="1"
              step="0.1"
              data-tooltip-source="#sigmaMasValue"
            />
          </label>

          <label class="cp-field">
            <span class="cp-label">Detector exaggeration (visual only)</span>
            <div id="exaggerationValue" class="cp-field__value">15.0x</div>
            <input
              id="exaggeration"
              class="cp-range"
              type="range"
              min="1"
              max="40"
              value="15"
              step="0.5"
              data-tooltip-source="#exaggerationValue"
            />
            <div class="cp-field__hint">Exaggeration affects visualization only, not computed $p$ or $d$.</div>
          </label>

          <div class="cp-notice">
            <h3>What to do</h3>
            <ol class="steps-list">
              <li>Set a distance, then drag Earth around the orbit.</li>
              <li>Watch the target shift on the detector relative to background stars.</li>
              <li>Use blink/overlay and read $2p\rightarrow p\rightarrow d$.</li>
              <li>Increase $\sigma_p$ and explain why distant stars are hard.</li>
            </ol>
          </div>

          <div class="cp-callout" data-kind="warning">
            <strong>Misconception check</strong>
            <div>Parallax is not the star moving - it's the viewing direction changing.</div>
          </div>

          <p id="status" class="cp-status" role="status" aria-live="polite" aria-atomic="true"></p>
        </div>
      </aside>

      <section class="cp-demo__stage cp-stage stage" aria-label="Parallax visualization stage">
        <div class="viz-layout">
          <div class="viz-panel">
            <div class="panel-title">View from Above (orbit geometry)</div>
            <svg
              id="orbitSvg"
              class="stage__svg"
              viewBox="0 0 560 420"
              role="img"
              aria-label="Top view showing Sun, Earth orbit, two observation epochs, and line-of-sight rays"
            >
              <rect x="0" y="0" width="560" height="420" rx="16" class="stage__bg" />

              <circle id="orbitPath" class="stage__orbit" cx="280" cy="220" r="138" />
              <circle id="sun" class="stage__sun" cx="280" cy="220" r="18" />
              <text class="stage__label stage__label--sun" x="280" y="252">Sun</text>

              <line id="baseline" class="stage__baseline" x1="0" y1="0" x2="0" y2="0" />
              <text id="baselineLabel" class="stage__label stage__label--baseline" x="280" y="388">Baseline ~ 2 AU (schematic)</text>

              <line id="rayEpochA" class="stage__ray stage__ray--jan" x1="0" y1="0" x2="0" y2="0" />
              <line id="rayEpochB" class="stage__ray stage__ray--jul" x1="0" y1="0" x2="0" y2="0" />

              <circle id="targetStar" class="stage__star" cx="280" cy="58" r="8" />
              <text id="targetStarLabel" class="stage__label stage__label--star" x="302" y="52">Target star</text>

              <circle id="earthEpochB" class="stage__earth stage__earth--jul" cx="0" cy="0" r="10" />
              <text id="earthEpochBLabel" class="stage__label stage__label--earth stage__label--earth-jul" x="0" y="0">Jul</text>

              <g
                id="earthEpochAGroup"
                class="earth-draggable"
                role="slider"
                tabindex="0"
                aria-label="Earth orbital phase"
                aria-valuemin="0"
                aria-valuemax="360"
                aria-valuenow="0"
                aria-valuetext="Jan"
              >
                <circle id="earthEpochA" class="stage__earth stage__earth--jan" cx="0" cy="0" r="11" />
              </g>
              <text id="earthEpochALabel" class="stage__label stage__label--earth stage__label--earth-jan" x="0" y="0">Jan</text>

              <text id="geometryCue" class="stage__note" x="280" y="28">Earth orbit changes line-of-sight direction to the same star.</text>
            </svg>
            <div class="schematic-note">Drag the blue Earth marker or use the phase slider.</div>
          </div>

          <div class="viz-panel" id="detectorPanel" data-detector-mode="overlay" data-blink="off">
            <div class="panel-title">As Seen on the Sky / Detector (observable shift)</div>
            <svg
              id="detectorSvg"
              class="stage__svg"
              viewBox="0 0 560 420"
              role="img"
              aria-label="Detector sky view with fixed background stars and two apparent target positions"
            >
              <rect x="0" y="0" width="560" height="420" rx="16" class="stage__bg" />

              <g id="backgroundStars" class="detector__background-stars">
                <circle cx="112" cy="84" r="3" />
                <circle cx="158" cy="146" r="2.5" />
                <circle cx="204" cy="70" r="2" />
                <circle cx="354" cy="92" r="2.5" />
                <circle cx="412" cy="138" r="2" />
                <circle cx="454" cy="248" r="3" />
                <circle cx="206" cy="278" r="2" />
                <circle cx="126" cy="242" r="2.5" />
              </g>

              <line id="detectorAxisX" class="detector__axis" x1="72" y1="210" x2="488" y2="210" />
              <line id="detectorAxisY" class="detector__axis" x1="280" y1="64" x2="280" y2="356" />

              <line id="differenceVector" class="detector__difference" x1="0" y1="0" x2="0" y2="0" />

              <circle id="errorCircleEpochA" class="detector__error detector__error--jan" cx="0" cy="0" r="0" />
              <circle id="errorCircleEpochB" class="detector__error detector__error--jul" cx="0" cy="0" r="0" />

              <g id="scatterEpochA" class="detector__scatter detector__scatter--jan"></g>
              <g id="scatterEpochB" class="detector__scatter detector__scatter--jul"></g>

              <circle id="detectorMarkerEpochA" class="stage__detector-dot stage__detector-dot--jan" cx="0" cy="0" r="7" />
              <circle id="detectorMarkerEpochB" class="stage__detector-dot stage__detector-dot--jul" cx="0" cy="0" r="7" />

              <text id="detectorEpochALabel" class="stage__label stage__label--detector-dot" x="0" y="0">Jan</text>
              <text id="detectorEpochBLabel" class="stage__label stage__label--detector-dot" x="0" y="0">Jul</text>

              <text id="detectorModeLabel" class="stage__note" x="280" y="28">Overlay mode: compare both epochs directly.</text>
              <text id="detectorSeparationLabel" class="stage__note" x="280" y="396">Measured angular separation = 2p.</text>
            </svg>
            <div class="schematic-note">Background stars stay fixed; target shifts with observer baseline.</div>
          </div>
        </div>
      </section>

      <div class="cp-readout-strip cp-demo__readouts" aria-label="Readouts">
        <div class="cp-readout">
          <span class="cp-readout__label">Angular separation $2p$</span>
          <span class="cp-readout__value"><span id="separationArcsec"></span><span class="cp-readout__unit">arcsec</span></span>
          <div class="cp-readout__sub"><span id="separationMas"></span> mas</div>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">Inferred parallax $p$</span>
          <span class="cp-readout__value"><span id="parallaxArcsec"></span><span class="cp-readout__unit">arcsec</span></span>
          <div class="cp-readout__sub"><span id="parallaxMas"></span> mas</div>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">Inferred distance $d$ in parsecs</span>
          <span class="cp-readout__value"><span id="distancePc"></span><span class="cp-readout__unit">pc</span></span>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">Inferred distance $d$ in light-years</span>
          <span class="cp-readout__value"><span id="distanceLy"></span><span class="cp-readout__unit">ly</span></span>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">Signal-to-noise $p/\sigma_p$</span>
          <span class="cp-readout__value"><span id="snr"></span></span>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">Measurement quality</span>
          <span class="cp-readout__value"><span id="snrQuality"></span></span>
        </div>
      </div>

      <section class="cp-demo__shelf cp-demo__drawer" aria-label="Information panels">
        <div class="cp-tabs-container">
          <div class="cp-tabs" role="tablist" aria-label="Demo information">
            <button class="cp-tab cp-tab--active" role="tab" aria-selected="true" aria-controls="tab-notice" id="tab-btn-notice">What to notice</button>
            <button class="cp-tab" role="tab" aria-selected="false" aria-controls="tab-model" id="tab-btn-model">Model notes</button>
            <button class="cp-tab" role="tab" aria-selected="false" aria-controls="tab-misconception" id="tab-btn-misconception">Misconceptions</button>
          </div>
          <div class="cp-tab-panel" role="tabpanel" id="tab-notice" aria-labelledby="tab-btn-notice">
            <ul>
              <li><strong>Cause:</strong> moving Earth changes the viewing direction to the same target.</li>
              <li><strong>Observable:</strong> the target marker shifts relative to fixed background stars.</li>
              <li><strong>Inference:</strong> measure $2p$, infer $p$, then compute $d(\mathrm{pc})=1/p(\mathrm{arcsec})$.</li>
            </ul>
          </div>
          <div class="cp-tab-panel" role="tabpanel" id="tab-model" aria-labelledby="tab-btn-model" hidden>
            <ul>
              <li>Small-angle parallax relation: $d\,(\mathrm{pc}) = 1/p\,(\mathrm{arcsec})$.</li>
              <li>Detector markers come from two epochs separated by about 6 months.</li>
              <li>Exaggeration scales displayed offsets only; readout math is unchanged.</li>
            </ul>
          </div>
          <div class="cp-tab-panel" role="tabpanel" id="tab-misconception" aria-labelledby="tab-btn-misconception" hidden>
            <ul>
              <li><strong>Parallax is not the star moving</strong>; it is the observer baseline changing.</li>
              <li>Greater distance means smaller $p$ and a smaller detector shift.</li>
              <li>Larger $\sigma_p$ causes overlap, making $p$ and therefore $d$ harder to infer.</li>
            </ul>
          </div>
        </div>
      </section>
    </div>

    <script type="module" src="./main.ts"></script>
  </body>
</html>
