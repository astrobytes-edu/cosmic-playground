<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Parallax Distance â€” Cosmic Playground</title>
    <link rel="stylesheet" href="./style.css" />
    <link rel="stylesheet" href="../../assets/katex/katex.min.css" />
  </head>
  <body>
    <canvas class="cp-starfield" aria-hidden="true"></canvas>
    <div
      id="cp-demo"
      class="cp-layer-instrument cp-demo parallax-demo"
      data-shell="triad"
      aria-label="Parallax Distance instrument"
    >
      <aside class="cp-demo__sidebar cp-panel" aria-label="Controls panel">
        <div class="cp-panel-header">Parallax Distance</div>
        <div class="cp-panel-body cp-scroll-shadow">
          <div class="cp-utility-toolbar" role="toolbar" aria-label="Demo actions">
            <button id="stationMode" class="cp-utility-btn" type="button" aria-label="Station mode" title="Station mode">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <rect x="4" y="2" width="12" height="16" rx="1.5"></rect>
                <line x1="7" y1="7" x2="13" y2="7"></line>
                <line x1="7" y1="10" x2="13" y2="10"></line>
                <line x1="7" y1="13" x2="10" y2="13"></line>
              </svg>
            </button>
            <button id="help" class="cp-utility-btn" type="button" aria-label="Help and shortcuts" title="Help / keys">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="10" cy="10" r="8"></circle>
                <path d="M7.5 7.5a2.5 2.5 0 0 1 5 0c0 1.5-2.5 2-2.5 3.5"></path>
                <circle cx="10" cy="15" r="0.75" fill="currentColor" stroke="none"></circle>
              </svg>
            </button>
            <button id="copyResults" class="cp-utility-btn" type="button" aria-label="Copy results" title="Copy results">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <rect x="6" y="6" width="10" height="12" rx="1.5"></rect>
                <path d="M14 6V3.5A1.5 1.5 0 0 0 12.5 2H5.5A1.5 1.5 0 0 0 4 3.5V14"></path>
              </svg>
            </button>
            <div class="cp-popover-anchor">
              <button class="cp-utility-btn cp-popover-trigger" aria-label="Navigation links" aria-expanded="false" aria-controls="navPopover" title="More links" type="button">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <circle cx="4" cy="10" r="1.5"></circle>
                  <circle cx="10" cy="10" r="1.5"></circle>
                  <circle cx="16" cy="10" r="1.5"></circle>
                </svg>
              </button>
              <div class="cp-popover" id="navPopover" hidden>
                <nav class="cp-popover__body">
                  <a class="cp-popover-link" href="../../exhibits/parallax-distance/">Open exhibit</a>
                  <a class="cp-popover-link" href="../../stations/parallax-distance/">Station card</a>
                  <a class="cp-popover-link" href="../../instructor/parallax-distance/">Instructor notes</a>
                </nav>
              </div>
            </div>
          </div>

          <p class="cp-muted">
            Watch the causal chain: Earth orbits, line-of-sight changes, and apparent position shifts against fixed background stars.
          </p>

          <div class="cp-callout" data-kind="model">
            <strong>Distance relation</strong>
            <div>$$d\,(\mathrm{pc})=\frac{1}{p\,(\mathrm{arcsec})}$$</div>
          </div>

          <div class="cp-workflow" aria-label="Capture workflow steps">
            <div id="stepSetDistance" class="cp-workflow-step" data-step-state="current">1. Set distance</div>
            <div id="stepCaptureA" class="cp-workflow-step" data-step-state="pending">2. Capture A</div>
            <div id="stepCaptureB" class="cp-workflow-step" data-step-state="pending">3. Capture B</div>
          </div>

          <label class="cp-field">
            <span class="cp-label">Preset star (optional)</span>
            <select id="starPreset" class="cp-select"></select>
          </label>

          <div class="cp-field">
            <span class="cp-label">Distance $d$ (primary input)</span>
            <div class="distance-input-grid">
              <label class="distance-input-cell">
                <span class="distance-input-label">pc</span>
                <input id="distancePcInput" class="cp-input" type="number" min="1" max="5000" step="0.1" value="10" />
              </label>
              <label class="distance-input-cell">
                <span class="distance-input-label">ly</span>
                <input id="distanceLyInput" class="cp-input" type="number" min="3.26" max="16308" step="0.1" value="32.62" />
              </label>
            </div>
            <div id="distancePcValue" class="cp-field__value">10.0 pc</div>
            <input id="distancePcRange" class="cp-range" type="range" min="1" max="5000" value="10" step="0.1" data-tooltip-source="#distancePcValue" />
            <div class="cp-field__hint">Parallax is inferred from captures, not set directly.</div>
          </div>

          <div class="cp-field">
            <span class="cp-label">Orbit motion and capture</span>
            <div class="capture-row">
              <button id="playPauseOrbit" class="cp-chip is-active" type="button" aria-pressed="true">Pause orbit</button>
              <button id="captureEpochA" class="cp-chip" type="button">Capture A</button>
              <button id="captureEpochB" class="cp-chip" type="button">Capture B</button>
            </div>
            <div class="capture-row">
              <button id="swapCaptures" class="cp-chip" type="button">Swap A/B</button>
              <button id="clearCaptures" class="cp-chip" type="button">Clear captures</button>
            </div>
            <div id="orbitPhaseValue" class="cp-field__value">Now: 0 deg</div>
            <input id="orbitPhaseScrub" class="cp-range" type="range" min="0" max="360" value="0" step="1" data-tooltip-source="#orbitPhaseValue" />
            <div id="captureSummary" class="cp-field__hint">Capture two moments to infer parallax.</div>
          </div>

          <div class="cp-field cp-field--compact">
            <label class="cp-check">
              <input id="showBaseline" type="checkbox" checked /> Show capture baseline vector
            </label>
          </div>

          <div class="cp-field">
            <span class="cp-label">Detector view mode</span>
            <div class="cp-chip-group" role="group" aria-label="Detector mode">
              <button id="detectorModeOverlay" class="cp-chip is-active" type="button" aria-pressed="true">Overlay</button>
              <button id="detectorModeDifference" class="cp-chip" type="button" aria-pressed="false">Difference</button>
            </div>
            <label class="cp-check cp-check--inline">
              <input id="blinkMode" type="checkbox" /> Blink A/B
            </label>
          </div>

          <label class="cp-field">
            <span class="cp-label">Astrometric measurement uncertainty $\sigma_{\rm meas}$</span>
            <div id="sigmaMasValue" class="cp-field__value">1.0 mas</div>
            <input id="sigmaMas" class="cp-range" type="range" min="0.1" max="20" value="1" step="0.1" data-tooltip-source="#sigmaMasValue" />
            <div class="cp-field__hint">Sets per-capture measurement uncertainty $\sigma_{\rm meas}$; inferred $\sigma_{\hat p}$ and $\sigma_{\hat d}$ appear in readouts.</div>
          </label>

          <label class="cp-field">
            <span class="cp-label">Detector exaggeration (visual only)</span>
            <div id="exaggerationValue" class="cp-field__value">15.0x</div>
            <input id="exaggeration" class="cp-range" type="range" min="1" max="40" value="15" step="0.5" data-tooltip-source="#exaggerationValue" />
            <div class="cp-field__hint">Exaggeration does not alter inferred $p$ or inferred $d$.</div>
          </label>

          <div class="cp-callout" data-kind="warning">
            <strong>Misconception check</strong>
            <div>The star does not zig-zag in space. The observer moved, so the viewing geometry changed.</div>
          </div>

          <p id="status" class="cp-status" role="status" aria-live="polite" aria-atomic="true"></p>
        </div>
      </aside>

      <section class="cp-demo__stage cp-stage stage" aria-label="Parallax visualization stage">
        <div class="viz-layout">
          <div class="viz-panel">
            <div class="panel-title">Cause: Orbit Geometry (Top View)</div>
            <svg id="orbitSvg" class="stage__svg" viewBox="0 0 560 420" role="img" aria-label="Top view showing Sun, moving Earth, target direction, parallax axis, and captured baseline">
              <rect x="0" y="0" width="560" height="420" rx="16" class="stage__bg" />

              <circle id="orbitPath" class="stage__orbit" cx="280" cy="220" r="138" />
              <circle id="sun" class="stage__sun" cx="280" cy="220" r="18" />
              <text class="stage__label stage__label--sun" x="280" y="252">Sun</text>

              <line id="targetDirectionLine" class="stage__direction" x1="280" y1="220" x2="280" y2="72" />
              <text id="targetDirectionLabel" class="stage__label stage__label--axis" x="280" y="58">Target direction</text>

              <line id="parallaxAxisLine" class="stage__axis" x1="112" y1="220" x2="448" y2="220" />
              <text id="parallaxAxisLabel" class="stage__label stage__label--axis" x="280" y="392">Parallax axis</text>

              <circle id="targetStar" class="stage__star" cx="280" cy="72" r="8" />
              <text id="targetStarLabel" class="stage__label stage__label--star" x="306" y="66">Target star</text>

              <line id="rayNow" class="stage__ray stage__ray--now" x1="0" y1="0" x2="0" y2="0" />
              <line id="rayCaptureA" class="stage__ray stage__ray--a" x1="0" y1="0" x2="0" y2="0" />
              <line id="rayCaptureB" class="stage__ray stage__ray--b" x1="0" y1="0" x2="0" y2="0" />

              <line id="baseline" class="stage__baseline" x1="0" y1="0" x2="0" y2="0" />
              <text id="baselineLabel" class="stage__label stage__label--baseline" x="280" y="372">Baseline pending captures</text>

              <circle id="earthNow" class="stage__earth stage__earth--now" cx="0" cy="0" r="10" />
              <text id="earthNowLabel" class="stage__label stage__label--earth stage__label--earth-now" x="0" y="0">Now</text>

              <circle id="earthCaptureA" class="stage__earth stage__earth--a" cx="0" cy="0" r="10" />
              <text id="earthCaptureALabel" class="stage__label stage__label--earth stage__label--earth-a" x="0" y="0">A</text>

              <circle id="earthCaptureB" class="stage__earth stage__earth--b" cx="0" cy="0" r="10" />
              <text id="earthCaptureBLabel" class="stage__label stage__label--earth stage__label--earth-b" x="0" y="0">B</text>

              <text id="geometryCue" class="stage__note" x="280" y="28">Earth motion changes the line-of-sight to the same star.</text>
            </svg>
            <div class="schematic-note">Live orbit drives detector shift. Captures freeze two epochs for inference.</div>
          </div>

          <div class="viz-panel" id="detectorPanel" data-detector-mode="overlay" data-blink="off">
            <div class="panel-title">Observable: Detector/Sky Shift</div>
            <svg id="detectorSvg" class="stage__svg" viewBox="0 0 560 420" role="img" aria-label="Detector view with fixed background stars and live plus captured apparent positions">
              <rect x="0" y="0" width="560" height="420" rx="16" class="stage__bg" />

              <g id="backgroundStars" class="detector__background-stars">
                <circle cx="112" cy="84" r="3" />
                <circle cx="158" cy="146" r="2.5" />
                <circle cx="204" cy="70" r="2" />
                <circle cx="354" cy="92" r="2.5" />
                <circle cx="412" cy="138" r="2" />
                <circle cx="454" cy="248" r="3" />
                <circle cx="206" cy="278" r="2" />
                <circle cx="126" cy="242" r="2.5" />
              </g>

              <line id="detectorMeasurementAxis" class="detector__axis" x1="72" y1="210" x2="488" y2="210" />
              <line id="differenceVector" class="detector__difference" x1="0" y1="0" x2="0" y2="0" />

              <circle id="errorCircleEpochA" class="detector__error detector__error--a" cx="0" cy="0" r="0" />
              <circle id="errorCircleEpochB" class="detector__error detector__error--b" cx="0" cy="0" r="0" />

              <g id="scatterEpochA" class="detector__scatter detector__scatter--a"></g>
              <g id="scatterEpochB" class="detector__scatter detector__scatter--b"></g>

              <circle id="detectorNow" class="stage__detector-dot stage__detector-dot--now" cx="0" cy="0" r="7" />
              <text id="detectorNowLabel" class="stage__label stage__label--detector-dot" x="0" y="0">Now</text>

              <circle id="detectorMarkerEpochA" class="stage__detector-dot stage__detector-dot--a" cx="0" cy="0" r="7" />
              <circle id="detectorMarkerEpochB" class="stage__detector-dot stage__detector-dot--b" cx="0" cy="0" r="7" />
              <text id="detectorEpochALabel" class="stage__label stage__label--detector-dot" x="0" y="0">A</text>
              <text id="detectorEpochBLabel" class="stage__label stage__label--detector-dot" x="0" y="0">B</text>

              <text id="detectorModeLabel" class="stage__note" x="280" y="28">Overlay mode: compare captured points directly.</text>
              <text id="detectorSeparationLabel" class="stage__note" x="280" y="396">Capture A and B to compute measured shift deltaTheta.</text>
              <text id="degenerateWarningLabel" class="stage__note stage__note--warning" x="280" y="378"></text>
            </svg>
            <div class="schematic-note">Background stars stay fixed while the apparent target position shifts.</div>
          </div>
        </div>
      </section>

      <div class="cp-readout-strip cp-demo__readouts" aria-label="Readouts">
        <div class="cp-readout">
          <span class="cp-readout__label">Measured shift $\Delta\theta$</span>
          <span class="cp-readout__value"><span id="deltaThetaMas"></span><span class="cp-readout__unit">mas</span></span>
          <div class="cp-readout__sub">Signed: <span id="deltaThetaSignedMas"></span> mas</div>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">Effective baseline $B_{\rm eff}$</span>
          <span class="cp-readout__value"><span id="baselineEffAu"></span><span class="cp-readout__unit">AU</span></span>
          <div class="cp-readout__sub">Chord: <span id="baselineChordAu"></span> AU | deltaPhi <span id="phaseSepDeg"></span> deg</div>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">Inferred parallax $\hat p$</span>
          <span class="cp-readout__value"><span id="parallaxMas"></span><span class="cp-readout__unit">mas</span></span>
          <div class="cp-readout__sub"><span id="parallaxArcsec"></span> arcsec</div>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">Equivalent Jan-Jul shift $2\hat p$ (derived)</span>
          <span class="cp-readout__value"><span id="equivalentShiftMas"></span><span class="cp-readout__unit">mas</span></span>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">True distance (set) $d_{\rm true}$</span>
          <span class="cp-readout__value"><span id="distancePcTrue"></span><span class="cp-readout__unit">pc</span></span>
          <div class="cp-readout__sub"><span id="distanceLyTrue"></span> ly</div>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">Inferred distance (measured) $\hat d$</span>
          <span class="cp-readout__value"><span id="distancePc"></span><span class="cp-readout__unit">pc</span></span>
          <div class="cp-readout__sub"><span id="distanceLy"></span> ly</div>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">Signal-to-noise $\hat p/\sigma_{\hat p}$ (inferred)</span>
          <span class="cp-readout__value"><span id="snr"></span></span>
          <div class="cp-readout__sub">Inferred parallax uncertainty $\sigma_{\hat p}$: <span id="sigmaPHatMas"></span> mas</div>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">Measurement quality</span>
          <span class="cp-readout__value"><span id="snrQuality"></span></span>
          <div class="cp-readout__sub">Inferred distance uncertainty $\sigma_{\hat d}$: <span id="sigmaDHatPc"></span> pc</div>
        </div>
      </div>

      <section class="cp-demo__shelf cp-demo__drawer" aria-label="Information panels">
        <div class="cp-tabs-container">
          <div class="cp-tabs" role="tablist" aria-label="Demo information">
            <button class="cp-tab cp-tab--active" role="tab" aria-selected="true" aria-controls="tab-notice" id="tab-btn-notice">What to notice</button>
            <button class="cp-tab" role="tab" aria-selected="false" aria-controls="tab-model" id="tab-btn-model">Model notes</button>
            <button class="cp-tab" role="tab" aria-selected="false" aria-controls="tab-misconception" id="tab-btn-misconception">Misconceptions</button>
          </div>
          <div class="cp-tab-panel" role="tabpanel" id="tab-notice" aria-labelledby="tab-btn-notice">
            <ul>
              <li><strong>Cause:</strong> Earth moves continuously, so the line-of-sight changes.</li>
              <li><strong>Observable:</strong> the target shifts against fixed background stars on the detector.</li>
              <li><strong>Inference:</strong> capture A and B, read $\Delta\theta$, then infer $\hat p$ and $\hat d$.</li>
            </ul>
          </div>
          <div class="cp-tab-panel" role="tabpanel" id="tab-model" aria-labelledby="tab-btn-model" hidden>
            <ul>
              <li>Distance relation: $d\,(\mathrm{pc}) = 1/p\,(\mathrm{arcsec})$.</li>
              <li>General capture inference uses projected shift and effective baseline $B_{\rm eff}$.</li>
              <li>Detector exaggeration changes only visualization, not computed $\hat p$ or $\hat d$.</li>
            </ul>
          </div>
          <div class="cp-tab-panel" role="tabpanel" id="tab-misconception" aria-labelledby="tab-btn-misconception" hidden>
            <ul>
              <li><strong>Parallax is not star motion</strong>; observer baseline changes drive the apparent shift.</li>
              <li>Small effective baseline captures can make inference unstable even if the chord is large.</li>
              <li>Larger measurement uncertainty $\sigma_{\rm meas}$ can dominate tiny shifts, weakening distance inference.</li>
            </ul>
          </div>
        </div>
      </section>
    </div>

    <script type="module" src="./main.ts"></script>
  </body>
</html>
