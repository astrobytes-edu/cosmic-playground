<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Retrograde Motion — Cosmic Playground</title>
    <link rel="stylesheet" href="./style.css" />
    <link rel="stylesheet" href="../../assets/katex/katex.min.css" />
  </head>
  <body>
    <canvas class="cp-starfield" aria-hidden="true"></canvas>
    <div
      id="cp-demo"
      class="cp-layer-instrument cp-demo"
      aria-label="Retrograde motion instrument"
    >
      <!-- ═══════════════════════════════════════════
           SIDEBAR — physics controls
           ═══════════════════════════════════════════ -->
      <aside class="cp-demo__sidebar cp-panel" aria-label="Controls panel">
        <div class="cp-panel-header">Retrograde Motion</div>
        <div class="cp-panel-body cp-scroll-shadow">
          <div class="cp-utility-toolbar" role="toolbar" aria-label="Demo actions">
            <button class="cp-utility-btn" id="btn-station-mode" aria-label="Station mode" title="Station mode">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <rect x="4" y="2" width="12" height="16" rx="1.5"/>
                <line x1="7" y1="7" x2="13" y2="7"/>
                <line x1="7" y1="10" x2="13" y2="10"/>
                <line x1="7" y1="13" x2="10" y2="13"/>
              </svg>
            </button>
            <button class="cp-utility-btn" id="btn-help" aria-label="Help and shortcuts" title="Help / Keys">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="10" cy="10" r="8"/>
                <path d="M7.5 7.5a2.5 2.5 0 0 1 5 0c0 1.5-2.5 2-2.5 3.5"/>
                <circle cx="10" cy="15" r="0.75" fill="currentColor" stroke="none"/>
              </svg>
            </button>
            <button class="cp-utility-btn" id="btn-challenges" aria-label="Challenges" title="Challenges">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M10 2l2.2 4.5 5 .7-3.6 3.5.8 5L10 13.4 5.6 15.7l.8-5L2.8 7.2l5-.7z"/>
              </svg>
            </button>
            <button type="button" class="cp-utility-btn" id="copyResults" aria-label="Copy results" title="Copy results">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <rect x="6" y="6" width="10" height="12" rx="1.5"/>
                <path d="M14 6V3.5A1.5 1.5 0 0 0 12.5 2H5.5A1.5 1.5 0 0 0 4 3.5V14"/>
              </svg>
            </button>
            <div class="cp-popover-anchor">
              <button class="cp-utility-btn cp-popover-trigger" aria-label="Navigation" aria-expanded="false" aria-controls="navPopover" title="More links">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <circle cx="4" cy="10" r="1.5"/>
                  <circle cx="10" cy="10" r="1.5"/>
                  <circle cx="16" cy="10" r="1.5"/>
                </svg>
              </button>
              <div class="cp-popover" id="navPopover" hidden>
                <nav class="cp-popover__body">
                  <a class="cp-popover-link" href="../../exhibits/retrograde-motion/">Open exhibit</a>
                  <a class="cp-popover-link" href="../../stations/retrograde-motion/">Station card</a>
                  <a class="cp-popover-link" href="../../instructor/retrograde-motion/">Instructor notes</a>
                </nav>
              </div>
            </div>
          </div>

          <div id="challenge-container"></div>

          <div class="cp-field">
            <span class="cp-label">Preset</span>
            <select id="preset" class="cp-select">
              <option value="earth-mars">Earth &rarr; Mars</option>
              <option value="earth-venus">Earth &rarr; Venus</option>
              <option value="earth-jupiter">Earth &rarr; Jupiter</option>
              <option value="earth-saturn">Earth &rarr; Saturn</option>
            </select>
          </div>

          <details class="cp-accordion">
            <summary>
              <span class="cp-accordion__title">Advanced</span>
              <span class="cp-accordion__meta"></span>
            </summary>
            <div class="cp-accordion__body">
              <div class="cp-field">
                <span class="cp-label">Observer planet</span>
                <select id="observer" class="cp-select">
                  <option value="Earth">Earth</option>
                  <option value="Venus">Venus</option>
                  <option value="Mars">Mars</option>
                  <option value="Jupiter">Jupiter</option>
                  <option value="Saturn">Saturn</option>
                </select>
              </div>

              <div class="cp-field">
                <span class="cp-label">Target planet</span>
                <select id="target" class="cp-select">
                  <option value="Mars">Mars</option>
                  <option value="Venus">Venus</option>
                  <option value="Jupiter">Jupiter</option>
                  <option value="Saturn">Saturn</option>
                </select>
              </div>

              <label class="cp-field">
                <span class="cp-label">Window length</span>
                <input
                  id="windowMonths"
                  class="cp-range"
                  type="range"
                  min="6"
                  max="36"
                  step="1"
                  value="24"
                />
                <div class="cp-muted"><span id="windowMonthsValue">24</span> <span class="cp-readout__unit">months</span></div>
              </label>

              <div class="cp-field">
                <span class="cp-label">Plot step</span>
                <select id="plotStepDay" class="cp-select">
                  <option value="0.25">0.25 day</option>
                  <option value="0.5">0.5 day</option>
                  <option value="1" selected>1 day</option>
                  <option value="2">2 days</option>
                </select>
              </div>

              <label class="cp-field">
                <input id="showZodiac" type="checkbox" />
                <span>Show zodiac ring</span>
              </label>

              <label class="cp-field">
                <input id="showOtherPlanets" type="checkbox" />
                <span>Show other planets</span>
              </label>
            </div>
          </details>

          <p id="status" class="cp-status" role="status" aria-live="polite" aria-atomic="true"></p>
        </div>
      </aside>

      <!-- ═══════════════════════════════════════════
           VIZ — longitude plot + orbit view
           ═══════════════════════════════════════════ -->
      <section class="cp-demo__stage cp-stage" aria-label="Visualization stage">
        <div class="viz-layout">
          <div class="viz-panel retro__plot-panel">
            <div class="panel-title">Apparent Longitude $\lambda_{\mathrm{app}}$</div>
            <span class="retro__state-badge" id="stateBadge">&rarr; Direct</span>
            <div id="plotFocus" class="retro__plot-focus" tabindex="0" aria-label="Longitude plot — click or drag to scrub time">
              <svg id="plotSvg" class="retro__svg" viewBox="0 0 1000 400"></svg>
            </div>
            <div class="retro__hint">Click or drag the plot to scrub time; arrow keys when focused.</div>
          </div>

          <div class="retro__right-col">
            <div class="viz-panel retro__orbit-panel">
              <div class="panel-title">Orbit View (top-down)</div>
              <svg id="orbitSvg" class="retro__svg" viewBox="0 0 420 420"></svg>
            </div>
            <div class="viz-panel retro__sky-panel">
              <div class="panel-title">Sky View</div>
              <svg id="skySvg" class="retro__sky-svg" viewBox="0 0 400 60"></svg>
            </div>
          </div>
        </div>
      </section>

      <!-- ═══════════════════════════════════════════
           PLAYBAR — animation transport + scrub
           ═══════════════════════════════════════════ -->
      <div class="cp-playbar" aria-label="Animation and timeline">
        <div class="playbar-transport">
          <button class="cp-playbar__btn" id="btn-play" type="button" aria-label="Play">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M4 2l10 6-10 6z"/></svg>
          </button>
          <button class="cp-playbar__btn" id="btn-pause" type="button" aria-label="Pause" disabled>
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><rect x="3" y="2" width="3.5" height="12"/><rect x="9.5" y="2" width="3.5" height="12"/></svg>
          </button>
          <button class="cp-playbar__btn" id="btn-step-back" type="button" aria-label="Step backward">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><rect x="2" y="2" width="2" height="12"/><path d="M14 2L6 8l8 6z"/></svg>
          </button>
          <button class="cp-playbar__btn" id="btn-step-forward" type="button" aria-label="Step forward">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><rect x="12" y="2" width="2" height="12"/><path d="M2 2l8 6-8 6z"/></svg>
          </button>
          <button class="cp-playbar__btn" id="btn-reset" type="button" aria-label="Reset to start" title="Reset to start">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 8a6 6 0 1 1 1.8 4.3"/><path d="M2 13V8h5"/></svg>
          </button>
          <label class="speed-control" for="speed-select">
            <span>Speed</span>
            <select id="speed-select" class="cp-select">
              <option value="1">1x</option>
              <option value="5" selected>5x</option>
              <option value="10">10x</option>
              <option value="20">20x</option>
            </select>
          </label>
        </div>

        <div class="playbar-scrub">
          <span class="playbar-day" id="playbar-day">Day 0 of 720</span>
          <input
            id="scrubSlider"
            class="cp-range"
            type="range"
            min="0"
            max="720"
            step="0.25"
            value="0"
            aria-label="Model day scrub"
          />
        </div>

        <div class="playbar-nav">
          <button id="prevStationary" class="cp-button cp-button--outline" type="button">
            &laquo; Prev stationary
          </button>
          <button id="centerRetrograde" class="cp-button cp-button--outline" type="button">
            &bull; Retrograde
          </button>
          <button id="nextStationary" class="cp-button cp-button--outline" type="button">
            Next stationary &raquo;
          </button>
        </div>
      </div>

      <!-- ═══════════════════════════════════════════
           READOUT STRIP — pinned readouts
           ═══════════════════════════════════════════ -->
      <div class="cp-readout-strip cp-demo__readouts" aria-label="Readouts">
        <div class="cp-readout">
          <span class="cp-readout__label">Day $t$</span>
          <span class="cp-readout__value"><span id="readoutDay">0.00</span><span class="cp-readout__unit">days</span></span>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">$\lambda_{\mathrm{app}}$</span>
          <span class="cp-readout__value"><span id="readoutLambda">&mdash;</span><span class="cp-readout__unit">deg</span></span>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">$d\tilde{\lambda}/dt$</span>
          <span class="cp-readout__value"><span id="readoutSlope">&mdash;</span><span class="cp-readout__unit">deg/day</span></span>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">State</span>
          <span class="cp-readout__value"><span id="readoutState">&mdash;</span></span>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">Retrograde</span>
          <span class="cp-readout__value"><span id="readoutRetroDuration">&mdash;</span><span class="cp-readout__unit">days</span></span>
        </div>
      </div>

      <!-- ═══════════════════════════════════════════
           SHELF — tabbed pedagogical content
           ═══════════════════════════════════════════ -->
      <section class="cp-demo__shelf" aria-label="Information panels">
        <div class="cp-tabs-container">
          <div class="cp-tabs" role="tablist" aria-label="Demo information">
            <button class="cp-tab cp-tab--active" role="tab" aria-selected="true"
                    aria-controls="tab-notice" id="tab-btn-notice">What to notice</button>
            <button class="cp-tab" role="tab" aria-selected="false"
                    aria-controls="tab-model" id="tab-btn-model">Model notes</button>
            <button class="cp-tab" role="tab" aria-selected="false"
                    aria-controls="tab-explore" id="tab-btn-explore">Explore further</button>
          </div>
          <div class="cp-tab-panel" role="tabpanel" id="tab-notice" aria-labelledby="tab-btn-notice">
            <ul>
              <li><strong>Observable:</strong> Watch the longitude plot. During the pink-shaded retrograde intervals, the target planet appears to reverse its motion against the background stars.</li>
              <li><strong>Model:</strong> Both planets orbit the Sun. When Earth overtakes Mars (or Venus overtakes Earth), the line of sight sweeps backward temporarily.</li>
              <li><strong>Inference:</strong> No planet actually reverses its orbit. Retrograde motion is a viewing-geometry effect. Its duration depends on the orbital-period ratio between observer and target.</li>
            </ul>
          </div>
          <div class="cp-tab-panel" role="tabpanel" id="tab-model" aria-labelledby="tab-btn-model" hidden>
            <ul>
              <li>Planets follow coplanar Keplerian ellipses with elements $(a, e, \varpi, L_0)$ from JPL Table 1 (Standish, 1800-2050).</li>
              <li>Time uses <strong>model day</strong> $t$ (no calendar claims). One model month $= 30$ days.</li>
              <li>Apparent longitude: $\lambda_{\mathrm{app}}(t) = \operatorname{atan2}(y_t - y_o,\, x_t - x_o)$, wrapped to $[0^\circ, 360^\circ)$.</li>
              <li>The unwrapped series $\tilde{\lambda}(t)$ uses a $180^\circ$ jump rule. Retrograde is defined by $d\tilde{\lambda}/dt &lt; 0$.</li>
              <li>Stationary points (where $d\tilde{\lambda}/dt = 0$) are refined by bisection to $10^{-3}$ day tolerance.</li>
            </ul>
          </div>
          <div class="cp-tab-panel" role="tabpanel" id="tab-explore" aria-labelledby="tab-btn-explore" hidden>
            <ul>
              <li><a href="../keplers-laws/">Kepler's Laws</a> — see the orbital mechanics behind these ellipses.</li>
              <li><a href="../eclipse-geometry/">Eclipse Geometry</a> — another viewing-geometry effect that depends on orbital alignment.</li>
              <li><strong>Historical context:</strong> Copernicus used retrograde motion to argue for heliocentrism. Ptolemy's epicycles were a mathematical description of this same apparent reversal, but placed Earth at the center.</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- First-retrograde annotation (hidden by default) -->
      <div class="retro__annotation" id="retroAnnotation" hidden>
        <span>The planet appears to reverse! This is <strong>retrograde motion</strong> — caused by Earth overtaking the target in its orbit.</span>
        <button class="retro__annotation-close" id="retroAnnotationClose" type="button" aria-label="Dismiss">&times;</button>
      </div>
    </div>

    <script type="module" src="./main.ts"></script>
  </body>
</html>
