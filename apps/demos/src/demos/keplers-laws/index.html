<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kepler's Laws - Cosmic Playground</title>
    <link rel="stylesheet" href="./style.css" />
    <link rel="stylesheet" href="../../assets/katex/katex.min.css" />
  </head>
  <body>
    <div
      id="cp-demo"
      class="cp-layer-instrument cp-demo kepler-demo"
      data-shell="viz-first"
      aria-label="Kepler's Laws instrument"
    >
      <canvas class="cp-starfield" aria-hidden="true"></canvas>
      <section class="cp-demo__stage cp-stage" aria-label="Orbit visualization stage">
        <div class="kepler-stage-header">
          <div>
            <div class="kepler-stage-title">Kepler's Laws Sandbox</div>
            <p class="kepler-stage-subtitle">Explore orbital mechanics: empirical patterns and physical laws.</p>
          </div>
          <div class="kepler-stage-actions"></div>
        </div>
        <div class="stage-surface">
          <canvas id="orbitCanvas" class="orbit-canvas" aria-hidden="true"></canvas>
          <svg id="orbitSvg" viewBox="0 0 600 400" preserveAspectRatio="xMidYMid meet">
            <defs>
              <radialGradient id="starGradient">
                <stop offset="0%" stop-color="var(--cp-celestial-sun-core)" />
                <stop offset="70%" stop-color="var(--cp-celestial-sun-mid)" />
                <stop offset="100%" stop-color="var(--cp-celestial-sun)" />
              </radialGradient>
              <radialGradient id="planetGradient" cx="30%" cy="30%">
                <stop offset="0%" stop-color="var(--cp-celestial-earth)" />
                <stop offset="100%" stop-color="var(--cp-celestial-earth-dark)" />
              </radialGradient>
              <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur stdDeviation="3" result="blur" />
                <feMerge>
                  <feMergeNode in="blur" />
                  <feMergeNode in="SourceGraphic" />
                </feMerge>
              </filter>
              <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                <polygon points="0 0, 10 3.5, 0 7" fill="currentColor" />
              </marker>
            </defs>

            <ellipse
              id="orbitPath"
              cx="300"
              cy="200"
              rx="200"
              ry="150"
              fill="none"
              stroke="var(--cp-border)"
              stroke-width="1"
              stroke-dasharray="4 4"
              opacity="0.6"
            />

            <g id="equalAreasGroup" hidden>
              <path
                id="equalAreasWedge"
                fill="var(--cp-accent-teal)"
                fill-opacity="0.2"
                stroke="var(--cp-accent-teal)"
                stroke-width="1"
              />
              <g id="equalTimeMarkers"></g>
            </g>

            <g id="fociGroup">
              <circle id="focus1" cx="300" cy="200" r="4" fill="var(--cp-celestial-sun)" />
              <circle id="focus2" cx="300" cy="200" r="3" fill="var(--cp-muted)" opacity="0.6" />
              <text id="focus1Label" x="300" y="215" text-anchor="middle" fill="var(--cp-muted)" font-size="10">
                Focus (Star)
              </text>
            </g>

            <g id="apsidesGroup">
              <circle id="perihelionMarker" cx="100" cy="200" r="4" fill="var(--cp-accent-rose)" />
              <text id="perihelionLabel" x="100" y="220" text-anchor="middle" fill="var(--cp-accent-rose)" font-size="9">
                Perihelion
              </text>
              <circle id="aphelionMarker" cx="500" cy="200" r="4" fill="var(--cp-accent-ice)" />
              <text id="aphelionLabel" x="500" y="220" text-anchor="middle" fill="var(--cp-accent-ice)" font-size="9">
                Aphelion
              </text>
            </g>

            <circle id="star" cx="300" cy="200" r="20" fill="url(#starGradient)" filter="url(#glow)" style="filter: drop-shadow(var(--cp-glow-sun))" />

            <line
              id="distanceLine"
              x1="300"
              y1="200"
              x2="400"
              y2="200"
              stroke="var(--cp-border)"
              stroke-width="1"
              stroke-dasharray="3 3"
            />

            <g id="velocityVector" class="newton-only" hidden>
              <line
                id="velocityLine"
                x1="400"
                y1="200"
                x2="400"
                y2="150"
                stroke="var(--cp-accent-ice)"
                stroke-width="2"
                marker-end="url(#arrowhead)"
              />
              <text id="velocityLabel" x="410" y="145" fill="var(--cp-accent-ice)" font-size="10">v</text>
            </g>

            <g id="forceVector" class="newton-only" hidden>
              <line
                id="forceLine"
                x1="400"
                y1="200"
                x2="350"
                y2="200"
                stroke="var(--cp-danger)"
                stroke-width="2"
                marker-end="url(#arrowhead)"
              />
              <text id="forceLabel" x="360" y="190" fill="var(--cp-danger)" font-size="10">F</text>
            </g>

            <g
              id="planetGroup"
              class="planet-draggable"
              role="slider"
              aria-label="Planet position on orbit"
              aria-valuemin="0"
              aria-valuemax="360"
              aria-valuenow="0"
              tabindex="0"
            >
              <circle id="planet" cx="400" cy="200" r="12" fill="url(#planetGradient)" />
            </g>

            <text
              id="distanceText"
              x="350"
              y="195"
              text-anchor="middle"
              fill="var(--cp-muted)"
              font-size="10"
            >
              r = 1.00 AU
            </text>
          </svg>
        </div>
      </section>

      <aside class="cp-demo__controls cp-panel" aria-label="Controls panel">
        <div class="cp-panel-header">Controls</div>
        <div class="cp-panel-body">
          <div class="cp-button-row" role="group" aria-label="Mode">
            <button id="modeKepler" class="cp-button cp-button--active" type="button">Kepler mode</button>
            <button id="modeNewton" class="cp-button cp-button--outline" type="button">Newton mode</button>
          </div>

          <details class="cp-accordion">
            <summary>
              <span class="cp-accordion__title">Keyboard shortcuts</span>
              <span class="cp-accordion__meta">Space, arrows, presets</span>
            </summary>
            <div class="cp-accordion__body">
              <ul class="cp-list">
                <li><kbd>Space</kbd>: Play/Pause</li>
                <li><kbd>Home</kbd> / <kbd>End</kbd>: Perihelion / Aphelion</li>
                <li><kbd>Left</kbd> / <kbd>Right</kbd>: Move along orbit (<kbd>Shift</kbd> = fine)</li>
                <li><kbd>K</kbd> / <kbd>N</kbd>: Kepler / Newton mode</li>
                <li><kbd>1</kbd>-<kbd>6</kbd>: Presets</li>
              </ul>
            </div>
          </details>

          <div class="cp-field">
            <label class="cp-label" for="aAu">Semi-major axis $a$</label>
            <div class="cp-field__value" id="aDisplay">1.00 AU</div>
            <input
              id="aAu"
              class="cp-range"
              type="range"
              min="0"
              max="1000"
              value="250"
              step="1"
              data-tooltip-source="#aDisplay"
            />
            <div class="cp-field__hint">0.3 AU $\rightarrow$ 40 AU (log scale)</div>
          </div>

          <div class="cp-field">
            <label class="cp-label" for="ecc">Eccentricity $e$</label>
            <div class="cp-field__value" id="eDisplay">0.017</div>
            <input
              id="ecc"
              class="cp-range"
              type="range"
              min="0"
              max="990"
              value="17"
              step="1"
              data-tooltip-source="#eDisplay"
            />
            <div class="cp-field__hint">0 (circle) $\rightarrow$ 0.99</div>
          </div>

          <div class="cp-field" id="massField" hidden>
            <label class="cp-label" for="massSlider">Star mass $M_*$</label>
            <div class="cp-field__value" id="massDisplay">1.0 M_sun</div>
            <input
              id="massSlider"
              class="cp-range"
              type="range"
              min="10"
              max="1000"
              value="100"
              step="1"
              data-tooltip-source="#massDisplay"
            />
            <div class="cp-field__hint">0.1 M_sun $\rightarrow$ 10 M_sun</div>
          </div>

          <div class="cp-field">
            <label class="cp-label" for="timelineScrub">Orbital phase</label>
            <div class="cp-field__value" id="phaseDisplay">0.00 / 1.00 yr</div>
            <input
              id="timelineScrub"
              class="cp-range"
              type="range"
              min="0"
              max="1000"
              value="0"
              step="1"
            />
            <input id="meanAnomalyDeg" class="sr-only" type="text" aria-hidden="true" value="0" />
          </div>

          <div class="cp-button-row" role="group" aria-label="Animation controls">
            <button id="play" class="cp-button" type="button">Play</button>
            <button id="pause" class="cp-button cp-button--outline" type="button" disabled>Pause</button>
            <button id="reset" class="cp-button cp-button--outline" type="button">Reset</button>
          </div>

          <div class="cp-field">
            <label class="cp-label" for="speedSelect">Speed (yr/s)</label>
            <select id="speedSelect" class="cp-select">
              <option value="0.1">0.1x</option>
              <option value="0.5">0.5x</option>
              <option value="1" selected>1x</option>
              <option value="2">2x</option>
              <option value="5">5x</option>
              <option value="10">10x</option>
            </select>
          </div>

          <div class="cp-field">
            <div class="cp-label">Presets</div>
            <div class="kepler-presets">
              <div class="kepler-preset-group">
                <div class="kepler-preset-label">Solar system</div>
                <div class="cp-chip-group--grid">
                  <button class="cp-chip preset" data-a="0.387" data-e="0.206" aria-pressed="false">Mercury</button>
                  <button class="cp-chip preset" data-a="0.723" data-e="0.007" aria-pressed="false">Venus</button>
                  <button class="cp-chip preset is-active" data-a="1.0" data-e="0.017" aria-pressed="true">Earth</button>
                  <button class="cp-chip preset" data-a="1.524" data-e="0.093" aria-pressed="false">Mars</button>
                  <button class="cp-chip preset" data-a="5.203" data-e="0.049" aria-pressed="false">Jupiter</button>
                  <button class="cp-chip preset" data-a="39.48" data-e="0.249" aria-pressed="false">Pluto</button>
                </div>
              </div>
              <div class="kepler-preset-group">
                <div class="kepler-preset-label">Extreme orbits</div>
                <div class="cp-chip-group--grid">
                  <button class="cp-chip preset" data-a="17.8" data-e="0.967" aria-pressed="false">Halley</button>
                  <button class="cp-chip preset" data-a="1.0" data-e="0.0" aria-pressed="false">Circular</button>
                  <button class="cp-chip preset" data-a="5.0" data-e="0.9" aria-pressed="false">High e</button>
                </div>
              </div>
            </div>
          </div>

          <div class="cp-field">
            <div class="cp-label">Overlays</div>
            <label class="cp-check">
              <input id="toggleFoci" type="checkbox" checked /> Foci
            </label>
            <label class="cp-check">
              <input id="toggleApsides" type="checkbox" checked /> Apsides
            </label>
            <label class="cp-check">
              <input id="toggleEqualAreas" type="checkbox" /> Equal areas
            </label>
            <label class="cp-check" id="toggleVectorsLabel" hidden>
              <input id="toggleVectors" type="checkbox" /> Vectors
            </label>
          </div>

          <div class="cp-utility-toolbar" role="toolbar" aria-label="Demo actions">
            <button id="stationMode" class="cp-utility-btn" type="button" aria-label="Station mode" title="Station mode">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <rect x="4" y="2" width="12" height="16" rx="1.5"></rect>
                <line x1="7" y1="7" x2="13" y2="7"></line>
                <line x1="7" y1="10" x2="13" y2="10"></line>
                <line x1="7" y1="13" x2="10" y2="13"></line>
              </svg>
            </button>
            <button id="help" class="cp-utility-btn" type="button" aria-label="Help and shortcuts" title="Help / keys">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="10" cy="10" r="8"></circle>
                <path d="M7.5 7.5a2.5 2.5 0 0 1 5 0c0 1.5-2.5 2-2.5 3.5"></path>
                <circle cx="10" cy="15" r="0.75" fill="currentColor" stroke="none"></circle>
              </svg>
            </button>
            <button id="copyResults" class="cp-utility-btn" type="button" aria-label="Copy results" title="Copy results">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <rect x="6" y="6" width="10" height="12" rx="1.5"></rect>
                <path d="M14 6V3.5A1.5 1.5 0 0 0 12.5 2H5.5A1.5 1.5 0 0 0 4 3.5V14"></path>
              </svg>
            </button>
            <div class="cp-popover-anchor">
              <button class="cp-utility-btn cp-popover-trigger" aria-label="Navigation links" aria-expanded="false" aria-controls="navPopover" title="More links" type="button">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <circle cx="4" cy="10" r="1.5"></circle>
                  <circle cx="10" cy="10" r="1.5"></circle>
                  <circle cx="16" cy="10" r="1.5"></circle>
                </svg>
              </button>
              <div class="cp-popover" id="navPopover" hidden>
                <nav class="cp-popover__body">
                  <a class="cp-popover-link" href="../../exhibits/keplers-laws/">Open exhibit</a>
                  <a class="cp-popover-link" href="../../stations/keplers-laws/">Station card</a>
                  <a class="cp-popover-link" href="../../instructor/keplers-laws/">Instructor notes</a>
                </nav>
              </div>
            </div>
          </div>

          <p id="status" class="cp-status" role="status" aria-live="polite" aria-atomic="true"></p>
          <p id="orbitStatus" class="cp-status sr-only" role="status" aria-live="polite" aria-atomic="true"></p>
        </div>
      </aside>

      <aside class="cp-demo__readouts cp-panel" aria-label="Readouts panel">
        <div class="cp-panel-header">Readouts</div>
        <div class="cp-panel-body">
          <div class="kepler-unit-toggle" role="group" aria-label="Unit system">
            <button id="unit101" class="cp-button cp-button--active" type="button">101</button>
            <button id="unit201" class="cp-button cp-button--outline" type="button">201</button>
          </div>

          <div class="cp-readout">
            <div class="cp-readout__label">Distance $r$</div>
            <div class="cp-readout__value" id="distanceValue">1.00</div>
            <div class="cp-readout__unit" id="distanceUnit">AU</div>
          </div>
          <div class="cp-readout">
            <div class="cp-readout__label">Speed $v$</div>
            <div class="cp-readout__value" id="velocityValue">29.8</div>
            <div class="cp-readout__unit" id="velocityUnit">km/s</div>
          </div>
          <div class="cp-readout">
            <div class="cp-readout__label">Acceleration</div>
            <div class="cp-readout__value" id="accelValue">5.93</div>
            <div class="cp-readout__unit" id="accelUnit">mm/s^2</div>
          </div>
          <div class="cp-readout">
            <div class="cp-readout__label">Period $P$</div>
            <div class="cp-readout__value" id="periodValue">1.00</div>
            <div class="cp-readout__unit">yr</div>
          </div>

          <details class="cp-accordion">
            <summary>
              <span class="cp-accordion__title">Conservation laws</span>
              <span class="cp-accordion__meta">energy + angular momentum</span>
            </summary>
            <div class="cp-accordion__body">
              <div class="cp-readout">
                <div class="cp-readout__label">Kinetic ($v^2/2$)</div>
                <div class="cp-readout__value" id="kineticValue">0</div>
                <div class="cp-readout__unit" id="kineticUnit">AU^2/yr^2</div>
              </div>
              <div class="cp-readout">
                <div class="cp-readout__label">Potential ($-\mu/r$)</div>
                <div class="cp-readout__value" id="potentialValue">0</div>
                <div class="cp-readout__unit" id="potentialUnit">AU^2/yr^2</div>
              </div>
              <div class="cp-readout">
                <div class="cp-readout__label">Total $\varepsilon$</div>
                <div class="cp-readout__value" id="energyValue">0</div>
                <div class="cp-readout__unit" id="energyUnit">AU^2/yr^2</div>
              </div>
              <div class="cp-readout">
                <div class="cp-readout__label">Angular momentum $h$</div>
                <div class="cp-readout__value" id="angmomValue">0</div>
                <div class="cp-readout__unit" id="angmomUnit">AU^2/yr</div>
              </div>
              <div class="cp-readout">
                <div class="cp-readout__label">Areal velocity ($dA/dt$)</div>
                <div class="cp-readout__value" id="arealValue">0</div>
                <div class="cp-readout__unit" id="arealUnit">AU^2/yr</div>
              </div>
            </div>
          </details>
        </div>
      </aside>

      <section class="cp-demo__drawer cp-drawer" aria-label="Panels">
        <div class="cp-panels">
          <details class="cp-accordion" open>
            <summary>
              <span class="cp-accordion__title">What to notice</span>
              <span class="cp-accordion__meta">3 bullets</span>
            </summary>
            <div class="cp-accordion__body">
              <ul class="cp-list">
                <li>When $e$ &gt; 0, the planet moves fastest near perihelion (closest point).</li>
                <li>Equal-area slices stay similar in area even when arc lengths differ.</li>
                <li>Bigger $a$ means a much longer period (Kepler 3).</li>
              </ul>
            </div>
          </details>

          <details class="cp-accordion">
            <summary>
              <span class="cp-accordion__title">Model note (teaching model)</span>
              <span class="cp-accordion__meta">AU / yr / M_sun</span>
            </summary>
            <div class="cp-accordion__body">
              <ul class="cp-list">
                <li>This simulation is a simplified, planar (2D) two-body model.</li>
                <li>It ignores perturbations and treats the planet as negligible-mass in Newton mode.</li>
                <li>The animation speed is a teaching scale (years per second), not real time.</li>
                <li>
                  Teaching normalization:
                  $G = 4\pi^2\,\frac{\mathrm{AU}^3}{\mathrm{yr}^2\,M_{\odot}}$.
                </li>
                <li>Kepler 3: $P^2 = \frac{a^3}{M}$.</li>
                <li>The time slider advances mean anomaly uniformly; position is solved from Kepler's equation.</li>
              </ul>
            </div>
          </details>
        </div>
      </section>
    </div>
    <script type="module" src="./main.ts"></script>
  </body>
</html>
