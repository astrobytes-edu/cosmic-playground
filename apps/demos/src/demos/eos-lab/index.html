<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EOS Lab â€” Cosmic Playground</title>
    <link rel="stylesheet" href="./style.css" />
    <link rel="stylesheet" href="../../assets/katex/katex.min.css" />
  </head>
  <body>
    <canvas class="cp-starfield" aria-hidden="true"></canvas>
    <div
      id="cp-demo"
      class="cp-layer-instrument cp-demo"
      data-shell="viz-first"
      aria-label="Equation of state lab instrument"
    >
      <aside class="cp-demo__controls cp-demo__sidebar cp-panel" aria-label="Controls panel">
        <div class="cp-panel-header">Equation of State Lab</div>
        <div class="cp-panel-body cp-scroll-shadow">
          <div class="cp-utility-toolbar" role="toolbar" aria-label="Demo actions">
            <button id="stationMode" class="cp-utility-btn" type="button" aria-label="Station mode" title="Station mode">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <rect x="4" y="2" width="12" height="16" rx="1.5"></rect>
                <line x1="7" y1="7" x2="13" y2="7"></line>
                <line x1="7" y1="10" x2="13" y2="10"></line>
                <line x1="7" y1="13" x2="10" y2="13"></line>
              </svg>
            </button>
            <button id="help" class="cp-utility-btn" type="button" aria-label="Help and shortcuts" title="Help / keys">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="10" cy="10" r="8"></circle>
                <path d="M7.5 7.5a2.5 2.5 0 0 1 5 0c0 1.5-2.5 2-2.5 3.5"></path>
                <circle cx="10" cy="15" r="0.75" fill="currentColor" stroke="none"></circle>
              </svg>
            </button>
            <button id="copyResults" class="cp-utility-btn" type="button" aria-label="Copy results" title="Copy results">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <rect x="6" y="6" width="10" height="12" rx="1.5"></rect>
                <path d="M14 6V3.5A1.5 1.5 0 0 0 12.5 2H5.5A1.5 1.5 0 0 0 4 3.5V14"></path>
              </svg>
            </button>
            <div class="cp-popover-anchor">
              <button class="cp-utility-btn cp-popover-trigger" aria-label="Navigation links" aria-expanded="false" aria-controls="navPopover" title="More links" type="button">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <circle cx="4" cy="10" r="1.5"></circle>
                  <circle cx="10" cy="10" r="1.5"></circle>
                  <circle cx="16" cy="10" r="1.5"></circle>
                </svg>
              </button>
              <div class="cp-popover" id="navPopover" hidden>
                <nav class="cp-popover__body">
                  <a class="cp-popover-link" href="../../exhibits/eos-lab/">Open exhibit</a>
                  <a class="cp-popover-link" href="../../stations/eos-lab/">Station card</a>
                  <a class="cp-popover-link" href="../../instructor/eos-lab/">Instructor notes</a>
                </nav>
              </div>
            </div>
          </div>

          <p class="cp-muted">
            Compare stellar pressure channels with explicit cgs units and assumption framing.
          </p>

          <div id="radiationClosureChip" class="cp-callout" data-kind="tip" role="note" aria-label="Radiation closure framing">
            <strong id="radiationClosureLabel">LTE closure likely reasonable</strong>
            <div id="radiationClosureNote">
              Radiation pressure uses $P_{\rm rad}=\eta_{\rm rad}aT^4/3$ with default $\eta_{\rm rad}=1$ in optically thick LTE-like conditions.
            </div>
          </div>

          <label class="cp-field control">
            <span class="cp-label">Temperature $T$ (K)</span>
            <input
              id="tempSlider"
              class="cp-range"
              type="range"
              min="0"
              max="1000"
              value="500"
              step="1"
              data-tooltip-source="#tempValue"
            />
            <span class="control__value"><span id="tempValue"></span></span>
          </label>

          <label class="cp-field control">
            <span class="cp-label">Density $\rho$ (g cm$^{-3}$)</span>
            <input
              id="rhoSlider"
              class="cp-range"
              type="range"
              min="0"
              max="1000"
              value="500"
              step="1"
              data-tooltip-source="#rhoValue"
            />
            <span class="control__value"><span id="rhoValue"></span></span>
          </label>

          <div class="cp-notice">
            <h3>Composition Controls</h3>
            <label class="cp-field control">
              <span class="cp-label">Hydrogen mass fraction $X$</span>
              <input
                id="xSlider"
                class="cp-range"
                type="range"
                min="0"
                max="1000"
                value="340"
                step="1"
                data-tooltip-source="#xValue"
              />
              <span class="control__value"><span id="xValue"></span></span>
            </label>
            <label class="cp-field control">
              <span class="cp-label">Helium mass fraction $Y$</span>
              <input
                id="ySlider"
                class="cp-range"
                type="range"
                min="0"
                max="1000"
                value="640"
                step="1"
                data-tooltip-source="#yValue"
              />
              <span class="control__value"><span id="yValue"></span></span>
            </label>
            <p class="cp-muted">
              Computed metal fraction $Z = 1 - X - Y$: <span id="zValue"></span>
            </p>
          </div>

          <div class="presets">
            <div class="presets__label">Preset states (ASTR 201)</div>
            <div id="presetButtons" class="presets__grid" role="group" aria-label="Preset states">
              <button class="cp-button cp-button--outline preset" type="button" data-preset-id="solar-core">Solar core</button>
              <button class="cp-button cp-button--outline preset" type="button" data-preset-id="solar-envelope">Solar envelope</button>
              <button class="cp-button cp-button--outline preset" type="button" data-preset-id="massive-core">Massive-star core</button>
              <button class="cp-button cp-button--outline preset" type="button" data-preset-id="red-giant-envelope">Red giant envelope</button>
              <button class="cp-button cp-button--outline preset" type="button" data-preset-id="white-dwarf-core">White dwarf core</button>
              <button class="cp-button cp-button--outline preset" type="button" data-preset-id="brown-dwarf-interior">Brown dwarf interior</button>
            </div>
            <p id="presetNote" class="cp-muted"></p>
          </div>

          <p id="status" class="cp-status" role="status" aria-live="polite" aria-atomic="true"></p>
        </div>
      </aside>

      <section class="cp-demo__stage cp-stage" aria-label="Pressure comparison stage">
        <div class="eos-stage-grid">
          <section class="pressure-plot" aria-label="Pressure-channel curve plot">
            <h3>Pressure Curves at Fixed Temperature</h3>
            <p class="cp-muted pressure-plot__help">
              Move sliders in real time to see how $P_{\rm gas}$, $P_{\rm rad}$, and $P_{\rm deg,e}$ vary with density at the current temperature and composition.
            </p>
            <div id="pressureCurvePlot" class="pressure-plot__surface"></div>
          </section>

          <section class="regime-map" aria-label="EOS regime map">
            <h3>Regime Map ($\log_{10}\rho$ vs $\log_{10}T$)</h3>
            <p class="cp-muted regime-map__help">
              Colors show the dominant pressure channel at each $(\rho,T)$ state for the current composition.
            </p>
            <canvas
              id="regimeMapCanvas"
              class="regime-map__surface"
              role="img"
              aria-label="EOS dominance map over log density and log temperature"
            ></canvas>
            <ul class="regime-map__legend" aria-label="Regime legend">
              <li><span data-channel="gas"></span>$P_{\rm gas}$ dominant</li>
              <li><span data-channel="radiation"></span>$P_{\rm rad}$ dominant</li>
              <li><span data-channel="degeneracy"></span>$P_{\rm deg,e}$ dominant</li>
              <li><span data-channel="mixed"></span>Mixed dominance</li>
            </ul>
            <p id="regimeDetail" class="cp-muted"></p>
            <p id="regimeSummary" class="cp-muted"></p>
          </section>
        </div>

        <div class="pressure-grid" aria-live="off">
          <article id="cardGas" class="pressure-card pressure-card--clickable" data-tone="secondary" role="button" tabindex="0" aria-label="Explore gas pressure deep dive">
            <h2>$P_{\rm gas}$</h2>
            <p class="pressure-card__value"><span id="pGasValue"></span> <span class="pressure-card__unit">dyne cm$^{-2}$</span></p>
            <div class="pressure-card__bar" aria-hidden="true"><span id="pGasBar"></span></div>
            <p class="pressure-card__hint">Thermal particle collisions; scales as $\rho T$. <em>Click to explore.</em></p>
          </article>

          <article id="cardRadiation" class="pressure-card pressure-card--clickable" data-tone="secondary" role="button" tabindex="0" aria-label="Explore radiation pressure deep dive">
            <h2>$P_{\rm rad}$</h2>
            <p class="pressure-card__value"><span id="pRadValue"></span> <span class="pressure-card__unit">dyne cm$^{-2}$</span></p>
            <div class="pressure-card__bar" aria-hidden="true"><span id="pRadBar"></span></div>
            <p class="pressure-card__hint">Photon momentum flux; scales as $T^4$ under LTE closure. <em>Click to explore.</em></p>
          </article>

          <article id="cardDegeneracy" class="pressure-card pressure-card--clickable" data-tone="secondary" role="button" tabindex="0" aria-label="Explore degeneracy pressure deep dive">
            <h2>$P_{\rm deg,e}$</h2>
            <p class="pressure-card__value"><span id="pDegValue"></span> <span class="pressure-card__unit">dyne cm$^{-2}$</span></p>
            <div class="pressure-card__bar" aria-hidden="true"><span id="pDegBar"></span></div>
            <p class="pressure-card__hint">Quantum correction beyond classical electrons; driven by Pauli exclusion. <em>Click to explore.</em></p>
          </article>
        </div>

        <section id="deepDiveGas" class="deep-dive" hidden>
          <button class="deep-dive__back cp-button cp-button--outline" type="button">Back to overview</button>
          <h3 class="deep-dive__title">Gas Pressure: Thermal Particle Collisions</h3>
          <div class="deep-dive__layout">
            <div class="deep-dive__animation">
              <canvas id="gasAnimCanvas" class="deep-dive__canvas" role="img" aria-label="Gas particles bouncing in a box"></canvas>
              <p class="deep-dive__caption">Particles hit walls &rarr; momentum transfer &rarr; pressure</p>
            </div>
            <div class="deep-dive__sandbox">
              <div id="gasEquation" class="deep-dive__equation"></div>
              <div class="deep-dive__controls">
                <label class="cp-field control">
                  <span class="cp-label">Temperature $T$ (K)</span>
                  <input id="gasDeepT" class="cp-range" type="range" min="0" max="1000" value="500" step="1" />
                  <span class="control__value"><span id="gasDeepTVal"></span></span>
                </label>
                <label class="cp-field control">
                  <span class="cp-label">Density $\rho$ (g cm$^{-3}$)</span>
                  <input id="gasDeepRho" class="cp-range" type="range" min="0" max="1000" value="500" step="1" />
                  <span class="control__value"><span id="gasDeepRhoVal"></span></span>
                </label>
              </div>
              <div id="gasDeepChart" class="deep-dive__chart"></div>
            </div>
          </div>
        </section>

        <section id="deepDiveRadiation" class="deep-dive" hidden>
          <button class="deep-dive__back cp-button cp-button--outline" type="button">Back to overview</button>
          <h3 class="deep-dive__title">Radiation Pressure: Photon Momentum</h3>
          <div class="deep-dive__layout">
            <div class="deep-dive__animation">
              <canvas id="radAnimCanvas" class="deep-dive__canvas" role="img" aria-label="Photons bouncing in a box"></canvas>
              <p class="deep-dive__caption">Photon flux &rarr; momentum deposited on walls &rarr; $T^4$ scaling</p>
            </div>
            <div class="deep-dive__sandbox">
              <div id="radEquation" class="deep-dive__equation"></div>
              <div class="deep-dive__controls">
                <label class="cp-field control">
                  <span class="cp-label">Temperature $T$ (K)</span>
                  <input id="radDeepT" class="cp-range" type="range" min="0" max="1000" value="500" step="1" />
                  <span class="control__value"><span id="radDeepTVal"></span></span>
                </label>
              </div>
              <div id="radDeepChart" class="deep-dive__chart"></div>
            </div>
          </div>
        </section>

        <section id="deepDiveDegeneracy" class="deep-dive" hidden>
          <button class="deep-dive__back cp-button cp-button--outline" type="button">Back to overview</button>
          <h3 class="deep-dive__title">Degeneracy Pressure: Pauli Exclusion</h3>
          <div class="deep-dive__layout">
            <div class="deep-dive__animation">
              <canvas id="degAnimCanvas" class="deep-dive__canvas" role="img" aria-label="Electron energy level filling"></canvas>
              <p class="deep-dive__caption">Fermions fill energy levels &rarr; exclusion forces higher momenta &rarr; pressure</p>
            </div>
            <div class="deep-dive__sandbox">
              <div id="degEquation" class="deep-dive__equation"></div>
              <div class="deep-dive__controls">
                <label class="cp-field control">
                  <span class="cp-label">Density $\rho$ (g cm$^{-3}$)</span>
                  <input id="degDeepRho" class="cp-range" type="range" min="0" max="1000" value="500" step="1" />
                  <span class="control__value"><span id="degDeepRhoVal"></span></span>
                </label>
              </div>
              <div id="degDeepChart" class="deep-dive__chart"></div>
            </div>
          </div>
        </section>

        <div class="stage-summary">
          <p><strong>Total pressure $P_{\rm tot}$:</strong> <span id="pTotalValue"></span> dyne cm$^{-2}$</p>
          <p><strong>Dominant channel:</strong> <span id="dominantChannel"></span></p>
        </div>
      </section>

      <div class="cp-readout-strip cp-demo__readouts" aria-label="Readouts">
        <div class="cp-readout">
          <span class="cp-readout__label">$\mu$</span>
          <span class="cp-readout__value"><span id="muValue"></span><span class="cp-readout__unit">$m_u$</span></span>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">$\mu_e$</span>
          <span class="cp-readout__value"><span id="muEValue"></span><span class="cp-readout__unit">$m_u$</span></span>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">$\beta=P_{\rm gas}/P_{\rm tot}$</span>
          <span class="cp-readout__value"><span id="betaValue"></span></span>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">$P_{\rm rad}/P_{\rm gas}$</span>
          <span class="cp-readout__value"><span id="radGasValue"></span><span class="cp-readout__unit">ratio</span></span>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">$P_{\rm deg,e}/P_{\rm tot}$</span>
          <span class="cp-readout__value"><span id="degTotalValue"></span></span>
        </div>
        <div class="cp-readout cp-readout--stack">
          <span class="cp-readout__label">$\chi_{\rm deg}=T/T_F$</span>
          <span class="cp-readout__value"><span id="chiDegValue"></span></span>
          <span id="degRegimeValue" class="cp-muted cp-readout__note"></span>
        </div>
      </div>

      <section class="cp-demo__drawer cp-demo__shelf cp-drawer" aria-label="Panels">
        <div class="cp-panels">
          <details class="cp-accordion" open>
            <summary>
              <span class="cp-accordion__title">What to notice</span>
              <span class="cp-accordion__meta">3 prompts</span>
            </summary>
            <div class="cp-accordion__body">
              <ul>
                <li>At fixed density, radiation pressure climbs much faster with $T$ than gas pressure.</li>
                <li>At high density, electron degeneracy can dominate even when thermal pressure is large.</li>
                <li>Composition shifts $\mu$ and $\mu_e$, changing both gas and degeneracy channels.</li>
              </ul>
            </div>
          </details>

          <details class="cp-accordion">
            <summary>
              <span class="cp-accordion__title">Model notes</span>
              <span class="cp-accordion__meta">cgs + assumptions</span>
            </summary>
            <div class="cp-accordion__body">
              <ul>
                <li>Gas pressure: $P_{\rm gas}=\rho k_B T/(\mu m_u)$.</li>
                <li>Radiation pressure: $P_{\rm rad}=\eta_{\rm rad} aT^4/3$ (default $\eta_{\rm rad}=1$).</li>
                <li>Finite-$T$ electron EOS uses Fermi-Dirac pressure $P_{e,\rm FD}(n_e,T)$ with nonrelativistic and relativistic branches.</li>
                <li>Displayed degeneracy channel is $P_{\rm deg,e}=\max\!\left(P_{e,\rm FD}-n_e k_B T,0\right)$.</li>
                <li>
                  Finite-$T$ proxy uses $1+\frac{5\pi^2}{12}\left(T/T_F\right)^2$ only when $x_F\ll1$ and $T/T_F\ll1$.
                </li>
                <li>$\mu$ and $\mu_e$ for fully ionized mixtures: $\mu^{-1}\approx2X+\frac{3}{4}Y+\frac{1}{2}Z$, $\mu_e^{-1}\approx X+\frac{Y}{2}+\frac{Z}{2}$.</li>
                <li>
                  Future hook: the kernel accepts additional pressure terms and alternate degeneracy providers for pair-rich and neutron extensions.
                </li>
              </ul>
            </div>
          </details>

          <details class="cp-accordion">
            <summary>
              <span class="cp-accordion__title">Deep Dive: Gas Pressure</span>
              <span class="cp-accordion__meta">cause + limits</span>
            </summary>
            <div class="cp-accordion__body">
              <p><strong>Physical cause:</strong> momentum transfer from thermal particle collisions.</p>
              <p><strong>Limits:</strong> assumes ideal fully ionized plasma; no Coulomb or partial-ionization corrections.</p>
            </div>
          </details>

          <details class="cp-accordion">
            <summary>
              <span class="cp-accordion__title">Deep Dive: Radiation Pressure</span>
              <span class="cp-accordion__meta">cause + limits</span>
            </summary>
            <div class="cp-accordion__body">
              <p><strong>Physical cause:</strong> photon momentum flux from a near-thermal radiation field.</p>
              <p><strong>Limits:</strong> LTE closure can fail in optically thin or strongly non-equilibrium regimes.</p>
            </div>
          </details>

          <details class="cp-accordion">
              <summary>
                <span class="cp-accordion__title">Deep Dive: Degeneracy Pressure</span>
                <span class="cp-accordion__meta">cause + limits</span>
              </summary>
              <div class="cp-accordion__body">
                <p><strong>Physical cause:</strong> Pauli exclusion fills momentum states even at low temperature.</p>
                <p><strong>Limits:</strong> finite-$T$ Fermi-Dirac electrons are included, but Coulomb/ion corrections and neutron-star matter channels are intentionally out of scope.</p>
              </div>
            </details>

          <details class="cp-accordion" open>
            <summary>
              <span class="cp-accordion__title">Advanced diagnostics</span>
              <span class="cp-accordion__meta">regime checks</span>
            </summary>
            <div class="cp-accordion__body">
              <p class="cp-muted">Fermi momentum regime + extension pathway diagnostics.</p>
              <div class="cp-readout">
                <div class="cp-readout__label">$x_F=p_F/(m_e c)$</div>
                <div class="cp-readout__value">
                  <span id="xFValue"></span>
                  <span class="cp-readout__unit">ratio</span>
                </div>
              </div>
              <div class="cp-readout">
                <div class="cp-readout__label">Fermi relativity regime</div>
                <div class="cp-readout__value">
                  <span id="fermiRegimeValue"></span>
                </div>
              </div>
              <div class="cp-readout">
                <div class="cp-readout__label">Sommerfeld factor $1+\frac{5\pi^2}{12}\left(T/T_F\right)^2$</div>
                <div class="cp-readout__value">
                  <span id="finiteTCorrectionValue"></span>
                  <span class="cp-readout__unit">factor</span>
                </div>
                <div class="cp-muted" id="finiteTValidityValue"></div>
              </div>
              <div class="cp-readout">
                <div class="cp-readout__label">Neutron extension pressure</div>
                <div class="cp-readout__value">
                  <span id="neutronExtensionValue"></span>
                  <span class="cp-readout__unit">dyne cm$^{-2}$</span>
                </div>
              </div>
            </div>
          </details>

          <details class="cp-accordion">
            <summary>
              <span class="cp-accordion__title">Composition interpretation</span>
              <span class="cp-accordion__meta">why $\mu$ matters</span>
            </summary>
            <div class="cp-accordion__body">
              <p class="cp-muted">
                Smaller $\mu$ means more particles per gram, so gas pressure increases at fixed $(\rho,T)$.
              </p>
            </div>
          </details>
        </div>
      </section>
    </div>
    <script type="module" src="./main.ts"></script>
  </body>
</html>
