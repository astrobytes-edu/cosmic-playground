<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Eclipse Geometry — Cosmic Playground</title>
    <link rel="stylesheet" href="./style.css" />
    <link rel="stylesheet" href="../../assets/katex/katex.min.css" />
  </head>
  <body>
    <div id="cp-demo" class="cp-layer-instrument cp-demo" aria-label="Eclipse Geometry instrument">
      <!-- ═══════════════════════════════════════════
           SIDEBAR — physics controls
           ═══════════════════════════════════════════ -->
      <aside class="cp-demo__sidebar cp-panel" aria-label="Controls panel">
        <div class="cp-panel-header">Eclipse Geometry: Shadows in Space</div>
        <div class="cp-panel-body cp-scroll-shadow">
          <p class="cp-muted">Investigate alignment, shadow cones, and why eclipses aren't monthly.</p>

          <div class="cp-callout" data-kind="model">
            Eclipses require two things at once: (1) the right phase (New/Full), and (2) the Moon near a node (small $|\beta|$).
          </div>

          <div class="cp-chip-group button-row" role="group" aria-label="Phase buttons">
            <button id="setNewMoon" class="cp-chip" type="button" aria-pressed="false">New Moon</button>
            <button id="setFullMoon" class="cp-chip" type="button" aria-pressed="false">Full Moon</button>
          </div>

          <div class="cp-popover-anchor">
            <button id="presetsBtn" class="cp-button cp-button--ghost cp-popover-trigger"
              type="button" aria-expanded="false" aria-controls="presetsPopover">
              Show me an eclipse...
            </button>
            <div class="cp-popover" id="presetsPopover" hidden>
              <div class="cp-popover__body">
                <button class="cp-popover-link" id="presetTotalSolar" type="button">Total solar eclipse</button>
                <button class="cp-popover-link" id="presetLunar" type="button">Lunar eclipse</button>
                <button class="cp-popover-link" id="presetNoEclipse" type="button">No eclipse (for comparison)</button>
                <button class="cp-popover-link" id="presetSeason" type="button">Eclipse season (animate)</button>
              </div>
            </div>
          </div>

          <label class="control">
            <span>Moon angle (deg)</span>
            <input
              id="moonLon"
              type="range"
              min="0"
              max="360"
              value="180"
              step="1"
              data-tooltip-source="#moonLonValue"
            />
            <span class="control__value"><span id="moonLonValue"></span></span>
          </label>

          <label class="control">
            <span>Orbital tilt $i$ ($^\circ$)</span>
            <input
              id="tilt"
              type="range"
              min="0"
              max="10"
              value="5.145"
              step="0.001"
              data-tooltip-source="#tiltValue"
            />
            <span class="control__value"><span id="tiltValue"></span></span>
          </label>

          <label class="control">
            <span>Earth–Moon distance (km)</span>
            <select id="distancePreset"></select>
            <span class="control__value"><span id="distanceValue"></span></span>
          </label>

          <div class="cp-callout" data-kind="activity">
            <strong>Time controls</strong>
            <div class="button-row" role="group" aria-label="Time controls">
              <button id="animateMonth" class="cp-button cp-button--ghost" type="button">Animate month</button>
              <button id="animateYear" class="cp-button cp-button--ghost" type="button">Animate 1 year</button>
            </div>
            <p id="motionNote" class="cp-muted" hidden></p>
          </div>

          <div class="cp-utility-toolbar" role="toolbar" aria-label="Demo actions">
            <button id="stationMode" class="cp-utility-btn" type="button" aria-label="Station mode" title="Station mode">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <rect x="4" y="2" width="12" height="16" rx="1.5"></rect>
                <line x1="7" y1="7" x2="13" y2="7"></line>
                <line x1="7" y1="10" x2="13" y2="10"></line>
                <line x1="7" y1="13" x2="10" y2="13"></line>
              </svg>
            </button>
            <button id="challengeMode" class="cp-utility-btn" type="button" aria-label="Challenges" title="Challenges">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M10 2l2.2 4.5 5 .7-3.6 3.5.8 5L10 13.4 5.6 15.7l.8-5L2.8 7.2l5-.7z"/>
              </svg>
            </button>
            <button id="help" class="cp-utility-btn" type="button" aria-label="Help and shortcuts" title="Help / keys">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="10" cy="10" r="8"></circle>
                <path d="M7.5 7.5a2.5 2.5 0 0 1 5 0c0 1.5-2.5 2-2.5 3.5"></path>
                <circle cx="10" cy="15" r="0.75" fill="currentColor" stroke="none"></circle>
              </svg>
            </button>
            <button id="copyResults" class="cp-utility-btn" type="button" aria-label="Copy results" title="Copy results">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <rect x="6" y="6" width="10" height="12" rx="1.5"></rect>
                <path d="M14 6V3.5A1.5 1.5 0 0 0 12.5 2H5.5A1.5 1.5 0 0 0 4 3.5V14"></path>
              </svg>
            </button>
            <div class="cp-popover-anchor">
              <button class="cp-utility-btn cp-popover-trigger" aria-label="Navigation links" aria-expanded="false" aria-controls="navPopover" title="More links" type="button">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <circle cx="4" cy="10" r="1.5"></circle>
                  <circle cx="10" cy="10" r="1.5"></circle>
                  <circle cx="16" cy="10" r="1.5"></circle>
                </svg>
              </button>
              <div class="cp-popover" id="navPopover" hidden>
                <nav class="cp-popover__body">
                  <a class="cp-popover-link" href="../../exhibits/eclipse-geometry/">Open exhibit</a>
                  <a class="cp-popover-link" href="../../stations/eclipse-geometry/">Station card</a>
                  <a class="cp-popover-link" href="../../instructor/eclipse-geometry/">Instructor notes</a>
                </nav>
              </div>
            </div>
          </div>
          <p id="status" class="cp-status" role="status" aria-live="polite" aria-atomic="true"></p>
        </div>
      </aside>

      <!-- ═══════════════════════════════════════════
           STAGE — dual-panel SVG visualization
           ═══════════════════════════════════════════ -->
      <section class="cp-demo__stage cp-stage stage" aria-label="Visualization stage">
        <canvas class="cp-starfield" aria-hidden="true"></canvas>
        <svg
          id="eclipseStage"
          class="stage__svg"
          viewBox="0 0 920 420"
          role="img"
          aria-label="Eclipse geometry visualization (orbit + beta indicator)"
        >
          <defs>
            <radialGradient id="earthGlow" cx="40%" cy="30%">
              <stop offset="0%" stop-color="var(--cp-celestial-earth)" stop-opacity="0.95" />
              <stop offset="100%" stop-color="var(--cp-celestial-earth)" stop-opacity="0.3" />
            </radialGradient>
            <radialGradient id="moonGlow" cx="40%" cy="30%">
              <stop offset="0%" stop-color="var(--cp-celestial-moon)" stop-opacity="0.95" />
              <stop offset="100%" stop-color="var(--cp-celestial-moon)" stop-opacity="0.3" />
            </radialGradient>
          </defs>

          <g id="orbitPanel" transform="translate(40, 40)">
            <text class="stage__title" x="0" y="0">Top view (ecliptic plane)</text>

            <g transform="translate(220, 180)">
              <line class="stage__sunDir" x1="-180" y1="0" x2="180" y2="0" />
              <text class="stage__label" x="180" y="-10" text-anchor="end">Sun direction</text>

              <circle class="stage__orbit" cx="0" cy="0" r="140" />

              <!-- Eclipse window arcs (4 tiers x 2 nodes) -->
              <path id="arc-solar-any-asc" class="stage__arc stage__arc--solar" d="" />
              <path id="arc-solar-central-asc" class="stage__arc stage__arc--solar stage__arc--central" d="" />
              <path id="arc-lunar-any-asc" class="stage__arc stage__arc--lunar" d="" />
              <path id="arc-lunar-central-asc" class="stage__arc stage__arc--lunar stage__arc--central" d="" />
              <path id="arc-solar-any-desc" class="stage__arc stage__arc--solar" d="" />
              <path id="arc-solar-central-desc" class="stage__arc stage__arc--solar stage__arc--central" d="" />
              <path id="arc-lunar-any-desc" class="stage__arc stage__arc--lunar" d="" />
              <path id="arc-lunar-central-desc" class="stage__arc stage__arc--lunar stage__arc--central" d="" />

              <circle class="stage__earth" cx="0" cy="0" r="16" />
              <text class="stage__label" x="0" y="32" text-anchor="middle">Earth</text>

              <circle id="ascNodeDot" class="stage__node" cx="140" cy="0" r="8" tabindex="0" role="button" aria-label="Ascending node" />
              <circle id="descNodeDot" class="stage__node" cx="-140" cy="0" r="8" tabindex="0" role="button" aria-label="Descending node" />
              <text id="ascNodeLabel" class="stage__label" x="0" y="-156" text-anchor="middle"></text>
              <text id="descNodeLabel" class="stage__label" x="0" y="170" text-anchor="middle"></text>

              <circle id="moonDot" class="stage__moon" cx="0" cy="0" r="10" />
              <line id="betaLine" class="stage__betaLine" x1="0" y1="0" x2="0" y2="0" />
            </g>
          </g>

          <g id="betaPanel" transform="translate(520, 40)">
            <text class="stage__title" x="0" y="0">Ecliptic latitude vs. orbital position</text>

            <g transform="translate(30, 180)">
              <!-- Horizontal axis: orbital position 0-360 deg -->
              <line class="stage__betaZero" x1="0" y1="0" x2="300" y2="0" />
              <!-- Vertical axis: beta -->
              <line class="stage__betaAxis" x1="0" y1="-140" x2="0" y2="140" />

              <!-- Axis labels -->
              <text class="stage__label" x="0" y="158" text-anchor="middle">0</text>
              <text class="stage__label" x="150" y="158" text-anchor="middle">180</text>
              <text class="stage__label" x="300" y="158" text-anchor="middle">360</text>
              <text class="stage__label" x="150" y="172" text-anchor="middle">orbital position (deg)</text>
              <text class="stage__label" x="-10" y="-130" text-anchor="end">+</text>
              <text class="stage__label" x="-10" y="134" text-anchor="end">-</text>
              <text class="stage__label" x="-14" y="4" text-anchor="end" style="font-style: italic;">beta</text>

              <!-- Threshold shading bands (updated by JS) -->
              <rect id="band-solar-partial" class="stage__band stage__band--solar" />
              <rect id="band-solar-central" class="stage__band stage__band--solar stage__band--central" />
              <rect id="band-lunar-penumbral" class="stage__band stage__band--lunar" />
              <!-- Threshold labels -->
              <text id="label-solar" class="stage__band-label stage__band-label--solar" text-anchor="end">solar</text>
              <text id="label-lunar" class="stage__band-label stage__band-label--lunar" text-anchor="end">lunar</text>

              <!-- Sinusoidal curve (updated by JS) -->
              <path id="betaCurve" class="stage__betaCurve" d="" />

              <!-- Moon marker on curve -->
              <circle id="betaMarker" class="stage__betaMarker" cx="0" cy="0" r="7" />
              <text id="betaLabel" class="stage__label" x="0" y="-18" text-anchor="middle"></text>
            </g>
          </g>

          <text class="stage__note" x="40" y="392">
            Note: The stage is schematic; the readouts use the model and are the authoritative values.
          </text>
        </svg>
      </section>

      <!-- ═══════════════════════════════════════════
           READOUT STRIP — horizontal readouts
           ═══════════════════════════════════════════ -->
      <div class="cp-readout-strip cp-demo__readouts" aria-label="Readouts">
        <div class="cp-readout">
          <span class="cp-readout__label">Phase</span>
          <span class="cp-readout__value" id="phaseLabel"></span>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">$\Delta$</span>
          <span class="cp-readout__value"><span id="phaseAngle"></span> <span class="cp-readout__unit">deg</span></span>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">$\beta$</span>
          <span class="cp-readout__value"><span id="absBeta"></span> <span class="cp-readout__unit">deg</span></span>
        </div>
        <div class="cp-readout cp-readout--solar" id="solarReadout">
          <span class="cp-readout__label">Solar</span>
          <span class="cp-readout__value"><span class="cp-readout__dot"></span><span id="solarOutcome"></span></span>
        </div>
        <div class="cp-readout cp-readout--lunar" id="lunarReadout">
          <span class="cp-readout__label">Lunar</span>
          <span class="cp-readout__value"><span class="cp-readout__dot"></span><span id="lunarOutcome"></span></span>
        </div>
        <div class="cp-readout">
          <span class="cp-readout__label">Node</span>
          <span class="cp-readout__value"><span id="nearestNode"></span> <span class="cp-readout__unit">deg</span></span>
        </div>
      </div>

      <!-- ═══════════════════════════════════════════
           CONTEXTUAL MESSAGE
           ═══════════════════════════════════════════ -->
      <p id="contextMessage" class="cp-status cp-context-message" aria-live="polite"></p>

      <!-- ═══════════════════════════════════════════
           SHELF — tabbed pedagogical + simulation content
           ═══════════════════════════════════════════ -->
      <section class="cp-demo__shelf" aria-label="Information panels">
        <div class="cp-tabs-container">
          <div class="cp-tabs" role="tablist" aria-label="Demo information">
            <button class="cp-tab cp-tab--active" role="tab" aria-selected="true"
                    aria-controls="tab-notice" id="tab-btn-notice">What to notice</button>
            <button class="cp-tab" role="tab" aria-selected="false"
                    aria-controls="tab-model" id="tab-btn-model">Model notes</button>
            <button class="cp-tab" role="tab" aria-selected="false"
                    aria-controls="tab-sim" id="tab-btn-sim">Simulation</button>
          </div>
          <div class="cp-tab-panel" role="tabpanel" id="tab-notice" aria-labelledby="tab-btn-notice">
            <ul>
              <li>Orbital tilt breaks "monthly eclipse" intuition.</li>
              <li>Small geometric differences determine eclipse visibility.</li>
            </ul>
          </div>
          <div class="cp-tab-panel" role="tabpanel" id="tab-model" aria-labelledby="tab-btn-model" hidden>
            <ul>
              <li>
                We model eclipse <em>geometry</em> using similar triangles for the umbra/penumbra and compute physically
                motivated thresholds (in degrees) for eclipse visibility.
              </li>
              <li>
                $\beta$ is the Moon's ecliptic latitude; when $|\beta|$ is small, the Moon is close to a node and an eclipse is
                possible at New/Full.
              </li>
              <li>
                Earth–Moon distance affects shadow size: at perigee a central solar eclipse can be total; at apogee it
                can be annular.
              </li>
            </ul>
          </div>
          <div class="cp-tab-panel" role="tabpanel" id="tab-sim" aria-labelledby="tab-btn-sim" hidden>
            <div class="sim-controls">
              <label class="control">
                <span>Years (log scale)</span>
                <input
                  id="simYears"
                  type="range"
                  min="0"
                  max="100"
                  value="33.3"
                  step="0.1"
                  data-tooltip-source="#simYearsValue"
                />
                <span class="control__value"><span id="simYearsValue"></span></span>
                <span class="sim-ticks" aria-hidden="true">
                  <span>1</span><span>10</span><span>100</span><span>1,000</span>
                </span>
              </label>

              <label class="control">
                <span>Speed</span>
                <select id="simSpeed">
                  <option value="slow">Slow</option>
                  <option value="medium" selected>Medium</option>
                  <option value="fast">Fast</option>
                </select>
              </label>

              <div class="button-row" role="group" aria-label="Simulation controls">
                <button id="runSimulation" class="cp-button cp-button--ghost" type="button">Run simulation</button>
                <button id="stopSimulation" class="cp-button cp-button--ghost" type="button">Stop</button>
              </div>

              <div id="simOutput" class="sim-output" hidden></div>
            </div>
          </div>
        </div>
      </section>
    </div>
    <script type="module" src="./main.ts"></script>
  </body>
</html>
