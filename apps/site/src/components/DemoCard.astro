---
import TagPill from "./TagPill.astro";
import TopicIcon from "./TopicIcon.astro";
import DemoGlyph from "./DemoGlyph.astro";
import { pickDemoGlyph } from "../lib/demoGlyphs";

export type DemoCardProps = {
  title: string;
  slug: string;
  href: string;
  description: string;
  status: "stable" | "beta" | "draft";
  topics: string[];
  levels: string[];
  timeMinutes: number;
  hasMathMode: boolean;
};

const {
  title,
  slug,
  href,
  description,
  status,
  topics,
  levels,
  timeMinutes,
  hasMathMode
} = Astro.props as DemoCardProps;

const glyph = pickDemoGlyph(topics, slug, title);
const statusTone =
  status === "stable" ? "teal" : status === "beta" ? "status-beta" : "status-draft";
const timeLabel =
  timeMinutes <= 10 ? "≤10 min" : timeMinutes <= 20 ? "10–20 min" : "20+ min";
---

<article class="demo-card cp-card">
  <a class="demo-card__link" href={href}>
    <header class="demo-card__header">
      <DemoGlyph name={glyph} class="demo-card__glyph" />
      <h3 class="demo-card__title">{title}</h3>
    </header>

    <p class="demo-card__desc">{description}</p>

    <footer class="demo-card__footer">
      <div class="demo-card__badges" aria-label="Tags">
        <TagPill label={status} tone={statusTone} />
        {topics.map((t) => (
          <TagPill label={t} tone="blue">
            <TopicIcon slot="icon" topic={t} />
          </TagPill>
        ))}
        <TagPill label={timeLabel} tone="default" />
        {levels.map((l) => <TagPill label={l} tone="default" />)}
        {hasMathMode ? <TagPill label="math mode" tone="violet" /> : null}
      </div>
    </footer>
  </a>
</article>

<style>
  .demo-card {
    border-radius: var(--cp-r-3);
    overflow: clip;
  }

  .demo-card__link {
    display: block;
    padding: 14px;
    text-decoration: none;
  }

  .demo-card__link:hover {
    background: color-mix(in srgb, var(--cp-text) 3%, transparent);
  }

  .demo-card__header {
    display: grid;
    gap: 10px;
  }

  .demo-card__glyph {
    width: clamp(28px, 4vw, 36px);
    height: clamp(28px, 4vw, 36px);
    color: var(--cp-text-3);
    transition: color var(--cp-transition-fast) var(--cp-ease-out),
      transform var(--cp-transition-fast) var(--cp-ease-out);
  }

  .demo-card:hover .demo-card__glyph,
  .demo-card:focus-within .demo-card__glyph {
    color: var(--cp-accent);
    transform: translateY(-1px);
  }

  .demo-card__title {
    margin: 0;
    font-size: var(--cp-text-xl);
    color: var(--cp-title);
    transition: color var(--cp-transition-fast) var(--cp-ease-out);
  }

  .demo-card__link:hover .demo-card__title,
  .demo-card__link:focus-visible .demo-card__title {
    color: var(--cp-title-strong);
  }

  .demo-card__desc {
    margin: 10px 0 0;
    color: var(--cp-text2);
    max-width: 72ch;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .demo-card__footer {
    margin-top: 12px;
  }

  .demo-card__badges {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    opacity: 0.9;
  }
</style>
