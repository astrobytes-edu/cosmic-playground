---
import Icon from "./Icon.astro";

export type FilterBarProps = {
  query: string;
  topic: string;
  level: string;
  time: string;
  status: string;
  math: string;
  sort: string;
  topics: string[];
  levels: string[];
  statuses: string[];
};

const {
  query,
  topic,
  level,
  time,
  status,
  math,
  sort,
  topics,
  levels,
  statuses
} = Astro.props as FilterBarProps;
---

<form class="filter-bar cp-card" method="get" action={`${import.meta.env.BASE_URL}explore/`} data-filter-form>
  <div class="filter-bar__row filter-bar__row--primary">
    <label class="filter-bar__field">
      <span class="filter-bar__label">Search</span>
      <div class="filter-bar__search">
        <Icon name="Search" size={18} class="filter-bar__search-icon" />
        <input
          class="cp-input"
          name="q"
          type="search"
          value={query}
          placeholder="title or tag…"
          autocomplete="off"
        />
      </div>
    </label>

    <label class="filter-bar__field">
      <span class="filter-bar__label">Topic</span>
      <select class="cp-select" name="topic">
        <option value="">All</option>
        {topics.map((t) => (
          <option value={t} selected={t === topic}>
            {t}
          </option>
        ))}
      </select>
    </label>

    <label class="filter-bar__field">
      <span class="filter-bar__label">Time</span>
      <select class="cp-select" name="time">
        <option value="">Any</option>
        <option value="lt10" selected={time === "lt10"}>≤10</option>
        <option value="10to20" selected={time === "10to20"}>10–20</option>
        <option value="gt20" selected={time === "gt20"}>20+</option>
      </select>
    </label>

    <label class="filter-bar__field">
      <span class="filter-bar__label">Sort</span>
      <select class="cp-select" name="sort">
        <option value="recommended" selected={sort === "recommended"}>
          Recommended
        </option>
        <option value="shortest" selected={sort === "shortest"}>Shortest</option>
        <option value="newest" selected={sort === "newest"}>Newest</option>
      </select>
    </label>
  </div>

  <div class="filter-bar__row filter-bar__row--secondary">
    <details class="filter-bar__details">
      <summary>More filters</summary>
      <div class="filter-bar__more">
        <label class="filter-bar__field">
          <span class="filter-bar__label">Level</span>
          <select class="cp-select" name="level">
            <option value="">All</option>
            {levels.map((l) => (
              <option value={l} selected={l === level}>
                {l}
              </option>
            ))}
          </select>
        </label>

        <label class="filter-bar__field">
          <span class="filter-bar__label">Status</span>
          <select class="cp-select" name="status">
            <option value="">Any</option>
            {statuses.map((s) => (
              <option value={s} selected={s === status}>
                {s}
              </option>
            ))}
          </select>
        </label>

        <label class="filter-bar__field">
          <span class="filter-bar__label">Math mode</span>
          <select class="cp-select" name="math">
            <option value="">Any</option>
            <option value="yes" selected={math === "yes"}>Yes</option>
            <option value="no" selected={math === "no"}>No</option>
          </select>
        </label>
      </div>
    </details>

    <button class="cp-button cp-button--ghost filter-bar__submit" type="submit">
      Apply
    </button>
  </div>
</form>

<style>
  .filter-bar {
    padding: 14px;
    display: grid;
    gap: 10px;
  }

  .filter-bar__row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 10px;
    align-items: end;
  }

  .filter-bar__row--secondary {
    grid-template-columns: 1fr auto;
    align-items: center;
  }

  .filter-bar__field {
    display: grid;
    gap: 6px;
  }

  .filter-bar__label {
    font-size: 0.9rem;
    color: var(--cp-muted);
  }

  .filter-bar__search {
    position: relative;
    display: flex;
    align-items: center;
  }

  .filter-bar__search-icon {
    position: absolute;
    left: 12px;
    color: var(--cp-muted);
    pointer-events: none;
  }

  .filter-bar__search input {
    padding-left: 40px;
  }

  .filter-bar__details {
    border: 0;
    padding: 0;
  }

  .filter-bar__details summary {
    cursor: pointer;
    list-style: none;
    color: var(--cp-muted);
    font-size: var(--cp-text-sm);
    margin-bottom: 8px;
  }

  .filter-bar__details summary::-webkit-details-marker {
    display: none;
  }

  .filter-bar__more {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 10px;
  }

  .filter-bar.is-enhanced .filter-bar__submit {
    display: none;
  }
</style>
