---
/**
 * Compact demo card for horizontal scroll strips.
 * Shows: DemoIllustration + title + primary topic + update date.
 */
import DemoIllustration from "./DemoIllustration.astro";
import TopicIcon from "./TopicIcon.astro";
import TagPill from "./TagPill.astro";
import { topicColor, primaryTopic } from "../lib/topicColors";

interface Props {
  title: string;
  slug: string;
  href: string;
  topics: string[];
  lastUpdated: string;
  status: "stable" | "beta" | "draft";
  readiness: "stub" | "experimental" | "candidate" | "launch-ready";
}

const { title, slug, href, topics, lastUpdated, status, readiness } = Astro.props;
const color = topicColor(primaryTopic(topics));
const statusTone =
  status === "stable" ? "teal" : status === "beta" ? "status-beta" : "status-draft";
const readinessTone =
  readiness === "launch-ready"
    ? "teal"
    : readiness === "candidate"
      ? "violet"
      : readiness === "experimental"
        ? "status-beta"
        : "status-draft";
---

<a class="mini-card cp-card" href={href} style={`--topic-color: ${color}`}>
  <div class="mini-card__illustration">
    <DemoIllustration slug={slug} />
  </div>
  <span class="mini-card__title">{title}</span>
  <span class="mini-card__meta">
    {topics[0] && <TopicIcon topic={topics[0]} size={12} />}
    <time class="mini-card__date">{lastUpdated}</time>
  </span>
  <span class="mini-card__state" aria-label="Demo state">
    <TagPill label={status} tone={statusTone} />
    <TagPill label={readiness} tone={readinessTone} />
  </span>
</a>

<style>
  .mini-card {
    display: flex;
    flex-direction: column;
    gap: var(--cp-space-2);
    min-width: 180px;
    max-width: 220px;
    text-decoration: none;
    flex-shrink: 0;
    overflow: clip;
    transition:
      transform 200ms var(--cp-ease-out),
      box-shadow 200ms var(--cp-ease-out),
      border-color 200ms var(--cp-ease-out);
  }

  .mini-card:hover {
    transform: translateY(-3px);
    box-shadow:
      var(--cp-card-shadow-hover),
      0 0 16px color-mix(in srgb, var(--topic-color) 10%, transparent);
    border-color: color-mix(in srgb, var(--topic-color) 30%, transparent);
  }

  @media (prefers-reduced-motion: reduce) {
    .mini-card { transition: none; }
    .mini-card:hover { transform: none; }
  }

  .mini-card__illustration {
    padding: var(--cp-space-2);
    background:
      radial-gradient(
        ellipse 80% 70% at 50% 50%,
        color-mix(in srgb, var(--topic-color) 6%, transparent) 0%,
        transparent 70%
      );
    border-bottom: 1px solid var(--cp-border-subtle);
  }

  .mini-card__title {
    font-weight: var(--cp-font-semibold);
    font-size: var(--cp-text-sm);
    color: var(--cp-title);
    line-height: var(--cp-leading-tight);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    padding: 0 var(--cp-space-3);
  }

  .mini-card:hover .mini-card__title {
    color: var(--cp-title-strong);
  }

  .mini-card__meta {
    display: flex;
    align-items: center;
    gap: var(--cp-space-1);
    color: var(--cp-faint);
    font-size: 0.75rem;
    margin-top: auto;
    padding: 0 var(--cp-space-3) var(--cp-space-3);
  }

  .mini-card__state {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    padding: 0 var(--cp-space-3) var(--cp-space-3);
  }

  .mini-card__date {
    font-family: var(--cp-font-mono);
    font-size: 0.7rem;
  }
</style>
