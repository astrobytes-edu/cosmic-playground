---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import IframeStage from "../../components/IframeStage.astro";
import TagPill from "../../components/TagPill.astro";

export async function getStaticPaths() {
  const demos = await getCollection("demos");
  return demos.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry }
  }));
}

const { entry } = Astro.props;

const demoHref = `${import.meta.env.BASE_URL}play/${entry.slug}/`;
const stationHref = `${import.meta.env.BASE_URL}stations/${entry.slug}/`;
const instructorHref = `${import.meta.env.BASE_URL}instructor/${entry.slug}/`;

const { Content } = await entry.render();
---

<Layout title={`${entry.data.title} — Exhibit`} hasMath={true}>
  <header class="exhibit-header cp-hero">
    <h1>{entry.data.title}</h1>
    <div class="badges" aria-label="Demo badges">
      <TagPill
        label={entry.data.status}
        tone={entry.data.status === "stable" ? "teal" : entry.data.status === "beta" ? "status-beta" : "status-draft"}
      />
      {entry.data.topics.map((t) => <TagPill label={t} tone="blue" />)}
      {entry.data.levels.map((l) => <TagPill label={l} tone="default" />)}
      <TagPill label={`${entry.data.time_minutes} min`} tone="default" />
      {entry.data.has_math_mode ? <TagPill label="math mode" tone="violet" /> : null}
    </div>
  </header>

  <section class="launch" aria-label="Launch controls">
    <a class="cp-button" href={demoHref}>Launch demo</a>
    <a class="cp-button cp-button--ghost" href={demoHref} target="_blank" rel="noreferrer"
      >Open fullscreen</a
    >
    <a class="cp-button cp-button--ghost" href={stationHref}>Station card</a>
    <a class="cp-button cp-button--ghost" href={instructorHref}>Instructor notes</a>
  </section>

  {!entry.data.content_verified ? (
    <section class="cp-callout" data-kind="warn" aria-label="Legacy content warning">
      <strong>Legacy content (unverified)</strong>
      <div>
        This exhibit’s copy was imported from the legacy ASTR101 SP26 demos and has not yet been
        fully reviewed against the current instrument UI, units, and exports.
      </div>
    </section>
  ) : null}

  <section class="block">
    <h2>Predict</h2>
    <p class="prompt">{entry.data.predict_prompt}</p>
  </section>

  <section class="block">
    <h2>Learning goals</h2>
    <ul>
      {entry.data.learning_goals.map((g) => (
        <li>{g}</li>
      ))}
    </ul>
  </section>

  <section class="block">
    <h2>Misconceptions targeted</h2>
    <ul>
      {entry.data.misconceptions.map((m) => (
        <li>{m}</li>
      ))}
    </ul>
  </section>

  <section class="block">
    <h2>Play</h2>
    <ol>
      {entry.data.play_steps.map((s) => (
        <li>{s}</li>
      ))}
    </ol>
  </section>

  <section class="block">
    <h2>Explain</h2>
    <p class="prompt">{entry.data.explain_prompt}</p>
  </section>

  <section class="block">
    <h2>Model notes</h2>
    <ul>
      {entry.data.model_notes.map((n) => (
        <li>{n}</li>
      ))}
    </ul>
  </section>

  <section class="block">
    <h2>About this demo</h2>
    <Content />
  </section>

  <IframeStage src={demoHref} title={entry.data.title} openHref={demoHref} />
</Layout>

<style>
  .exhibit-header {
    display: grid;
    gap: 10px;
  }

  .exhibit-header h1 {
    margin: 0;
    font-size: 1.9rem;
  }

  .badges {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 10px;
  }

  .launch {
    margin-top: 14px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }

  .block {
    margin-top: 18px;
    padding: var(--cp-space-4);
    border-radius: var(--cp-r-3);
    border: 1px solid var(--cp-border);
    background: var(--cp-bg1);
  }

  .block h2 {
    margin: 0 0 8px;
  }

  .prompt {
    color: var(--cp-text);
    font-weight: 600;
  }

  ul,
  ol {
    margin: 0;
    padding-left: 18px;
    color: var(--cp-muted);
  }

  li {
    margin: 6px 0;
  }
</style>
